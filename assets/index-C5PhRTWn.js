import{r as l,j as e,a as Te}from"./react-Dl5khTFu.js";import{c as Me}from"./react-dom-CaK7Gm4w.js";import{T as Pe,a as Qe}from"./react-icons-C76KGiBO.js";import{a as X}from"./axios-upsvKRUO.js";import{C as je,a as Ne,S as Ee,T as ke,I as Ie,Q as se,M as Fe,b as ze,F as Oe,c as He,D as Ue,X as Ye,d as We,A as Se,G as Ge,L as Ke,B as fe,U as ye,e as we}from"./lucide-react-CpluNwkn.js";import{S as Ce}from"./react-select-DNjq-Jfl.js";import{H as Ve,a as be}from"./html5-qrcode-DoJAUVNV.js";import{T as Xe,a as Je,b as Ze,c as de}from"./@radix-ui-FaNOjPFF.js";import"./hoist-non-react-statics-DUIF_pJT.js";import"./react-is-8JwjhRSi.js";import"./scheduler-CylivXx-.js";import"./@babel-DeGXz7kM.js";import"./@emotion-C1jRIs2C.js";import"./stylis-YPZU7XtI.js";import"./@floating-ui-DZ2V_EUC.js";import"./use-isomorphic-layout-effect-Do5Xa1W_.js";import"./memoize-one-DxrTgWdQ.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const p of document.querySelectorAll('link[rel="modulepreload"]'))u(p);new MutationObserver(p=>{for(const g of p)if(g.type==="childList")for(const f of g.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&u(f)}).observe(document,{childList:!0,subtree:!0});function a(p){const g={};return p.integrity&&(g.integrity=p.integrity),p.referrerPolicy&&(g.referrerPolicy=p.referrerPolicy),p.crossOrigin==="use-credentials"?g.credentials="include":p.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function u(p){if(p.ep)return;p.ep=!0;const g=a(p);fetch(p.href,g)}})();const er="/icm_lib/assets/img-Dm6ee46N.png",rr="/icm_lib/assets/bookshelf-8M74edYe.png",Le=l.createContext(),tr=({children:r})=>{const[s,a]=l.useState(()=>localStorage.getItem("language")||"he");l.useEffect(()=>{document.documentElement.lang=s,document.documentElement.dir=s==="he"?"rtl":"ltr",localStorage.setItem("language",s),console.log("Language updated to:",s)},[s]);const u=l.useCallback(()=>{a(g=>{const f=g==="en"?"he":"en";return console.log("Toggling language from",g,"to",f),f})},[]),p={language:s,toggleLanguage:u,direction:s==="he"?"rtl":"ltr"};return e.jsx(Le.Provider,{value:p,children:r})},J=()=>l.useContext(Le),sr={by:"by",app_title:"Israeli Community of Madrid Library",title:"Book Title",author:"Author",description:"Description",year_of_publication:"Year of Publication",cover_type:"Cover Type",pages:"Pages",borrowing_child:"Borrowing Child's Name",borrowed_by:"Borrowed By",borrower:"Borrower",borrow:"Borrow Book",delivery_status:"Delivery Status",delivering_parent:"Delivering Parent",recommended_age:"Recommended Age",borrow_date:"Borrow Date",return_date:"Return Date",NotReturned:"Not Returned",add_book_label:"Add New Book",books:"Books",members:"Members",loans:"Loans",ShowAllLoans:"Show History",Hide_Details:"Hide Details",More_Details:"More Details",loan_status:"Availability",sort_by:"Order by",ascending:"Ascending",descending:"Descending",Hide_Add_Book:"Hide Add Book",Add_Book:"Add Book",return:"Return Book",Select_Book:"Select Book",Select_Book_State:"Select Book State",ScanQR:"Scan QR Code",download_qr_code:"Download QR Code",SendReminders:"Send Reminders",last_reminder:"last reminder at",no_reminder_sent:"No Reminders Sent",sending_reminders:"Sending...",send_x_reminders:"Send {count} Reminders",error_generating_report:"Failed to generate report. Please try again.",reports:"Reports",generate_report_button:"Generate report",select_borrower:"Select Borrower",add_member_button:"Add Member",edit_member:"Edit Member",delete_member:"Delete Member",close_add_member_button:"Close Add Member",add_member_form_title:"Add New Member",search_placeholder:"Search members by name",members_list_title:"Library Members",no_members_found:"No members found",select_all:"Select All",deselect_all:"Deselect All",borrowed_books_label:"Borrowed books",parent_name_placeholder:"Parent's Name",kid_name_placeholder:"Kid's Name",parent_name_borrower:"Parent",kid_name_borrower:"Kid",email_placeholder:"Email Address",error_parent_name_required:"Parent's name is required.",error_kid_name_required:"Kid's name is required.",error_email_required:"Email address is required.",error_email_invalid:"Invalid email address.",email_missing_warning:"No email provided - notifications will not be sent to this member",confirm_delete_member:"Are you sure you want to delete this member?",no_email_provided:"No email provided",success_member_added:"Member added successfully!",success_member_updated:"Member updates successfully!",success_member_deleted:"Member deleted successfully!",parent_name_label:"Parent Name",kid_name_label:"Child Name",email_label:"Email",inventory_list_title:"Library Inventory",add_book_button:"Add Book",close_add_book_button:"Close Add Book",search_books_placeholder:"Search books by title",no_books_found:"No books found",placeholder_book_title:"Enter Book Title",placeholder_book_author:"Enter Author Name",placeholder_book_description:"Enter Description",placeholder_book_year:"Enter Year of Publication",placeholder_book_pages:"Enter Number of Pages",placeholder_book_recommended_age:"Enter Recommended Age",select_condition:"Select Condition",select_loan_status:"Select loan status",select_parent:"Select Parent",select_cover_type:"format",soft_cover:"Soft Cover",hard_cover:"Hard Cover",rigid_pages:"Rigid Pages",battery_book:"Book with Battery",new:"Like New",good:"Excellent - No noticeable wear",worn:"Good - Minor wear",available:"Available",borrowed:"Borrowed",error_book_title_required:"Book title is required.",error_book_author_required:"Author name is required.",error_book_description_required:"Description is required.",error_book_year_required:"Year of publication is required.",error_book_pages_required:"Number of pages is required.",cannot_delete_with_borrowed_books:"Cannot delete a member with borrowed books",inventory_report:"Inventory Report",loans_report:"Loans Report",select_report_type:"Select Report Type",report_options:"Report Options",select_field:"Select Field",book_title:"Book Title",id:"ID",order:"Order",include_history:"Include Historical Loans",include_borrowed:"Include Currently Borrowed Books",update_book_button:"Update book information",edit_book:"Edit book information",login_title:"Library Login",username:"Username",password:"Password",username_placeholder:"Enter username",password_placeholder:"Enter password",login_button:"Login",logging_in:"Logging in...",invalid_credentials:"Invalid username or password.",system_status:"System Status",database_status:"Database Status",backend_status:"Backend Status",connected:"Connected",disconnected:"Disconnected",logout:"Logout",navigate:"Navigate",qr_codes_report:"Print QR Codes",qr_codes_available:"There are {count} QR codes available.",qr_codes_description:"This report generates a printable PDF of QR codes arranged in a grid with cutting guides.",inventory_report_description:"This report generates an Excel file with current inventory details. You can sort the data by various fields and choose to include borrowed items.",loans_report_description:"This report generates an Excel file of active loans. You can choose to include historical loans and sort by various fields.",no_qr_codes:"No QR Codes",qr_codes:"QR Codes",qr_scan_failed:"Scan Failed",qr_select_image:"Select an image",qr_error_no_code:"No QR code detected. Please try again with a clearer image.",qr_error_no_support:"Your browser doesn't support QR scanning. Try another browser.",qr_error_timeout:"Scanning timed out. Try using a smaller image.",qr_error_unreadable:"The QR code is unclear or damaged. Try a different image.",qr_error_tips:"Try using a well-lit image with the entire QR code visible and in focus",qr_error_large_file:"The image file is too large. Please use a smaller image.",qr_error_generic:"Couldn't scan the QR code",qr_try_again:"Try Again",qr_cancel:"Cancel",processing_image:"Processing Image...",error_scanning:"Scanning of the QR code failed"},or={by:"על ידי",app_title:"ספריית הקהילה הישראלית במדריד",title:"שם הספר",author:"שם המחבר",description:"תיאור",year_of_publication:"שנת הוצאה",cover_type:"סוג כריכה",pages:"עמודים",borrowing_child:"שם הילד המשאיל",borrowed_by:"הושאל על ידי",borrower:"המשאיל",borrow:"השאל ספר",delivery_status:"מצב מסירה",delivering_parent:"שם ההורה המוסר",recommended_age:"גיל מומלץ",borrow_date:"תאריך השאלה",return_date:"תאריך החזרה",NotReturned:"לא הוחזר",add_book_label:"הוסף ספר חדש",books:"ספרים",members:"חברים",loans:"השאלות",ShowAllLoans:"הצג היסטוריה",Hide_Details:"הסתר פרטים",More_Details:"עוד פרטים",loan_status:"זמינות",sort_by:"סדר לפי",ascending:"עולה",descending:"יורד",Hide_Add_Book:"הסתר הוספת ספר",Add_Book:"הוסף ספר",return:"החזר ספר",Select_Book:"בחר ספר",Select_Book_State:"מצב הספר",ScanQR:"סרוק ברקוד",download_qr_code:"הורד ברקוד",SendReminders:"שלח תזכורת",last_reminder:"תזכורת אחרונה ב",no_reminder_sent:"לא נשלחה תזכורת",sending_reminders:"שולח...",send_x_reminders:"שלח {count} תזכורות",error_generating_report:"הפקת הדוח נכשלה, נסה שנית בבקשה.",reports:"דוחות",generate_report_button:"הפק דוח",select_borrower:"בחר משאיל",add_member_button:"הוסף חבר",edit_member:"ערוך",delete_member:"מחק חבר",close_add_member_button:"סגור הוספת חבר",add_member_form_title:"הוספת חבר חדש",search_placeholder:"חפש חברים לפי שם",members_list_title:"חברי הספרייה",no_members_found:"לא נמצאו חברים",select_all:"בחר הכל",deselect_all:"הסר בחירה",borrowed_books_label:"ספרים מושאלים",parent_name_placeholder:"שם ההורה המשאיל",kid_name_placeholder:"שם הילד המשאיל",parent_name_borrower:"ההורה",kid_name_borrower:"הילד",email_placeholder:"כתובת אימייל",error_parent_name_required:"נדרש שם הורה.",error_kid_name_required:"נדרש שם ילד.",error_email_required:"נדרשת כתובת אימייל.",error_email_invalid:"כתובת אימייל לא תקינה.",email_missing_warning:"לא סופק אימייל - לא יישלחו התראות לחבר זה",no_email_provided:"לא סופק אימייל",success_member_added:"החבר נוסף בהצלחה!",success_member_updated:"החבר עודכן בהצלחה!",success_member_deleted:"חבר נמחק בהצלחה!",parent_name_label:"שם ההורה",kid_name_label:"שם הילד",email_label:"אימייל",inventory_list_title:"מלאי הספרייה",add_book_button:"הוסף ספר",close_add_book_button:"סגור הוספת ספר",search_books_placeholder:"חפש ספרים לפי שם",no_books_found:"לא נמצאו ספרים",placeholder_book_title:"הכנס שם הספר",placeholder_book_author:"הכנס שם המחבר",placeholder_book_description:"הכנס תיאור",placeholder_book_year:"הכנס שנת הוצאה",placeholder_book_pages:"הכנס מספר עמודים",placeholder_book_recommended_age:"הכנס גיל מומלץ",select_condition:"מצב מסירה",select_loan_status:"זמינות",select_parent:"שם ההורה",select_cover_type:"פורמט",soft_cover:"כריכה רכה",hard_cover:"כריכה קשה",rigid_pages:"עמודים קשיחים",battery_book:"ספר עם בטריה",new:"כמו חדש",good:"מצויין - בלאי בלתי מורגש",worn:"טוב - בלאי קל",available:"זמין",borrowed:"מושאל",error_book_title_required:"נדרש שם ספר.",error_book_author_required:"נדרש שם מחבר.",error_book_description_required:"נדרש תיאור.",error_book_year_required:"נדרשת שנת הוצאה.",error_book_pages_required:"נדרש מספר עמודים.",confirm_delete_member:"האם אתה בטוח שברצונך למחוק חבר זה?",cannot_delete_with_borrowed_books:"לא ניתן למחוק חבר עם השאלות פתוחות",inventory_report:"דוח מלאי",loans_report:"דוח השאלות",select_report_type:"בחר סוג דוח",report_options:"אפשרויות דוח",select_field:"בחר שדה",book_title:"כותרת הספר",id:"מזהה",order:"סדר",include_history:"כלול היסטורית השאלות",include_borrowed:"כלול ספרים מושאלים",update_book_button:"עדכון ספר",edit_book:"ערוך ספר",login_title:"כניסה לספרייה",username:"שם משתמש",password:"סיסמה",username_placeholder:"הכנס שם משתמש",password_placeholder:"הכנס סיסמה",login_button:"כניסה",logging_in:"מתחבר...",invalid_credentials:"שם משתמש או סיסמה לא נכונים.",system_status:"מצב מערכת",database_status:"מצב מסד נתונים",backend_status:"מצב שרת",connected:"מחובר",disconnected:"מנותק",logout:"התנתק",navigate:"לשוניות",qr_codes_report:"הדפס קודי QR",qr_codes_available:"ישנם {count} קודי QR זמינים.",qr_codes_description:"דוח זה יפיק קובץ PDF להדפסה של קודי QR המסודרים ברשת עם קווים לחיתוך.",inventory_report_description:"דוח זה מייצר קובץ Excel עם פרטי המלאי הנוכחי. ניתן למיין את הנתונים לפי שדות שונים ולבחור לכלול פריטים מושאלים.",loans_report_description:"דוח זה מייצר קובץ Excel של הלוואות פעילות. ניתן לבחור לכלול הלוואות היסטוריות ולמיין לפי שדות שונים.",no_qr_codes:"No QR Codes",qr_codes:"קוד QR",qr_scan_failed:"הסריקה נכשלה",qr_select_image:"בחר תמונה",qr_error_no_code:"לא זוהה קוד QR. נסה שוב עם תמונה ברורה יותר.",qr_error_no_support:"הדפדפן שלך אינו תומך בסריקת QR. נסה דפדפן אחר.",qr_error_timeout:"הסריקה נמשכה יותר מדי זמן. נסה להשתמש בתמונה קטנה יותר.",qr_error_unreadable:"קוד ה-QR אינו קריא או פגום. נסה תמונה אחרת.",qr_error_tips:"נסה להשתמש בתמונה מוארת היטב עם כל קוד ה-QR גלוי וממוקד",qr_error_large_file:"קובץ התמונה גדול מדי. השתמש בתמונה קטנה יותר.",qr_error_generic:"לא ניתן לסרוק את קוד ה-QR",qr_try_again:"נסה שוב",qr_cancel:"ביטול",processing_image:"מעבד תמונה...",error_scanning:"סריקת הקוד נכשלה"},Z=r=>r==="he"?or:sr,ar=(r,s)=>({"כריכה רכה":s.soft_cover,"כריכה קשה":s.hard_cover,"עמודים קשיחים":s.rigid_pages,"ספר עם בטריה":s.battery_book})[r]||"N/A",nr=(r,s)=>({"כמו חדש":s.new,"מצויין - בלאי בלתי מורגש":s.good,"טוב - בלאי קל":s.worn})[r]||"N/A",V="https://religious-cherianne-dbprops-ef8ee171.koyeb.app",I=X.create({baseURL:V});I.interceptors.request.use(r=>{const s=localStorage.getItem("authToken");return console.log("Token in localStorage:",s),s&&(r.headers.Authorization=s),r},r=>Promise.reject(r));I.interceptors.response.use(r=>r,r=>(r.response&&r.response.status===403&&(localStorage.removeItem("authToken"),alert("Session expired. Please log in again."),window.location.reload()),Promise.reject(r)));const lr=async()=>{try{const r=await fetch(`${V}/api/neon-status`);if(!r.ok)throw new Error("Database unreachable");return(await r.json()).status==="operational"?"operational":"error"}catch(r){return console.error("NeonDB health check failed:",r),"error"}},Re=async()=>{try{return await X.get(`${V}/api/health`),!0}catch{return!1}},ir=async(r,s)=>{try{return(await X.post(`${V}/api/login`,{username:r,password:s})).data}catch{throw new Error("Invalid username or password")}},cr=async r=>{try{return(await I.post("/api/members",r)).data}catch{throw new Error("Failed to add member.")}},qe=async()=>{try{return(await I.get("/api/members")).data.map(s=>({...s,borrowed_books_count:s.borrowed_books_count||0}))}catch(r){throw console.error("Error fetching members:",r),r}},dr=async r=>{try{return(await I.get(`/api/members/${r}/loans`)).data.loans}catch(s){throw console.error(`Error fetching loans for member ${r}:`,s),s}},ur=async(r,s)=>{try{return(await I.put(`/api/members/${r}`,s)).data}catch(a){throw console.error("Error updating member:",a),a}},mr=async r=>{try{return(await I.delete(`/api/members/${r}`)).data}catch(s){throw console.error("Error deleting member:",s),s}},hr=async(r="desc")=>{try{return(await X.get(`${V}/api/books?order_by=${r}`)).data}catch(s){throw console.error("Error fetching books:",s),s}},pr=async r=>{try{return(await I.post("/api/books",r,{headers:{"Content-Type":"application/json"}})).data}catch(s){throw console.error("Error adding book:",s),new Error("Failed to add book.")}},gr=async r=>{try{const s=await I.get(`/api/qr_codes/${r}`,{responseType:"blob"}),a=window.URL.createObjectURL(new Blob([s.data])),u=document.createElement("a");u.href=a,u.setAttribute("download",`${r}.png`),document.body.appendChild(u),u.click(),u.remove()}catch(s){throw console.error("Error downloading QR code:",s),s}},br=async(r,s)=>{try{return(await I.put(`${V}/api/books/${r}`,s)).data}catch(a){throw console.error("Error updating book:",a),a}},_r=({onLogin:r})=>{const[s,a]=l.useState(""),[u,p]=l.useState(""),[g,f]=l.useState(""),[v,M]=l.useState(!1),{language:C,toggleLanguage:b,direction:m}=J(),x=Z(C),[B,Q]=l.useState(!1);l.useEffect(()=>{const S=async()=>{const y=await Re();Q(y)};S();const j=setInterval(S,1e4);return()=>clearInterval(j)},[]);const P=async S=>{S.preventDefault(),M(!0);try{const j=await ir(s,u);localStorage.setItem("authToken",j.token),r()}catch{f(x.invalid_credentials)}M(!1)};return e.jsxs("div",{className:`min-h-screen relative flex items-center justify-center ${m==="rtl"?"rtl":"ltr"}`,children:[e.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat opacity-20",style:{backgroundImage:`url(${rr})`,backgroundSize:"cover",backgroundPosition:"center",zIndex:0}}),e.jsx("div",{className:"absolute top-2 right-2 flex items-center",children:B?e.jsx(Pe,{className:"text-green-500",size:24,title:"Connected"}):e.jsx(Qe,{className:"text-red-500",size:24,title:"Disconnected"})}),e.jsx("button",{className:"w-10 h-10 flex items-center justify-center rounded-full border border-teal-500 bg-white/40 text-teal-500 shadow-md absolute top-2 left-2",onClick:()=>{b(),document.documentElement.dir=m==="rtl"?"ltr":"rtl"},style:{zIndex:50},children:C==="en"?"HE":"EN"}),e.jsxs("div",{className:"relative z-10 w-full max-w-[320px] sm:max-w-[380px] mx-4 rounded-3xl overflow-hidden shadow-xl",children:[e.jsx("div",{className:"bg-white rounded-3xl p-4",children:e.jsx("img",{src:er,alt:"ICM Library Logo",className:"h-12 sm:h-16 w-auto mx-auto"})}),e.jsx("div",{className:"transition-all duration-300",children:e.jsxs("form",{onSubmit:P,className:"backdrop-blur-sm bg-white/20 p-6 sm:p-8 rounded-3xl",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold mb-4 sm:mb-6 text-center text-gray-800",children:x.login_title}),g&&e.jsx("div",{className:"text-red-500 text-sm mb-4 bg-red-50 p-2 rounded",children:g}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{htmlFor:"username",className:"block text-gray-700 text-sm font-medium mb-2",children:x.username}),e.jsx("input",{id:"username",type:"text",className:`w-full p-2.5 sm:p-3 border border-gray-200 rounded-md
                                             bg-white/50 backdrop-blur-sm focus:ring-2
                                             focus:ring-blue-500 focus:border-transparent`,value:s,onChange:S=>a(S.target.value),placeholder:x.username_placeholder,dir:m==="rtl"?"rtl":"ltr"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-gray-700 text-sm font-medium mb-2",children:x.password}),e.jsx("input",{id:"password",type:"password",className:`w-full p-2.5 sm:p-3 border border-gray-200 rounded-md
                                                 bg-white/50 backdrop-blur-sm focus:ring-2
                                                 focus:ring-blue-500 focus:border-transparent`,value:u,onChange:S=>p(S.target.value),placeholder:x.password_placeholder,dir:m==="rtl"?"rtl":"ltr"})]}),e.jsx("button",{type:"submit",className:`w-full py-2.5 sm:py-3 rounded-md transition duration-200 
                                         ${v?"bg-gray-400 cursor-not-allowed":"bg-blue-500 hover:bg-blue-600 active:bg-blue-700"} text-white font-semibold shadow-md`,disabled:v,children:v?x.logging_in:x.login_button})]})]})})]})]})},xr=()=>{const[r,s]=l.useState([]),[a,u]=l.useState("desc"),[p,g]=l.useState(""),[f,v]=l.useState(""),[M,C]=l.useState(""),[b,m]=l.useState(""),[x,B]=l.useState(""),[Q,P]=l.useState(""),[S,j]=l.useState(""),[y,c]=l.useState(""),[q]=l.useState("available"),[w,k]=l.useState(""),[F,D]=l.useState([]),[A,E]=l.useState(!1),[R,U]=l.useState(""),[G,z]=l.useState({}),{language:d,toggleLanguage:T,direction:$}=J(),t=Z(d),[L,W]=l.useState(null),[h,O]=l.useState(""),oe=[{value:"כריכה רכה",label:t.soft_cover},{value:"כריכה קשה",label:t.hard_cover},{value:"עמודים קשיחים",label:t.rigid_pages},{value:"ספר עם בטריה",label:t.battery_book}],ae=[{value:"כמו חדש",label:t.new},{value:"מצויין - בלאי בלתי מורגש",label:t.good},{value:"טוב - בלאי קל",label:t.worn}];l.useEffect(()=>{ne(),ue()},[a]),l.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[]);const ne=async()=>{try{const n=await hr(a);Array.isArray(n)?s(n):(console.error("Unexpected response format:",n),s([]))}catch(n){console.error("Failed to load books:",n),s([])}},ue=async()=>{try{const n=await qe();D(n)}catch(n){console.error("Error fetching members:",n)}},me=async n=>{n.preventDefault();try{const K={title:p,author:f,description:M,year_of_publication:b,pages:x,cover_type:Q,book_condition:S||"טוב - בלאי קל",recommended_age:y,loan_status:q,delivering_parent:w};L?await br(L,K):await pr(K),W(null),O(""),g(""),v(""),C(""),m(""),B(""),P(oe[0].value),j(ae[0].value),k(""),E(!1),await ne()}catch(K){console.error("Error saving book:",K)}},he=n=>{E(!0),W(n.id),O(n.qr_code),g(n.title),v(n.author||""),C(n.description||""),m(n.year_of_publication||""),B(n.pages||""),P(n.cover_type||""),j(n.book_condition||""),c(n.recommended_age||""),k(n.delivering_parent||"")},pe=n=>{z(K=>({...K,[n]:!K[n]}))},le=n=>{gr(n).then(()=>console.log("QR Code downloaded successfully")).catch(K=>console.error("Failed to download QR Code:",K))};return e.jsxs("div",{className:"w-full max-w-md mx-auto",children:[e.jsx("div",{className:"flex flex-col mb-4",children:e.jsx("input",{id:"search_by_name",type:"text",placeholder:t.search_books_placeholder,value:R,onChange:n=>U(n.target.value),className:`flex-1 border border-gray-300 rounded-md py-1.5 px-4 ${d==="he"?"text-right":"text-left"}`})}),e.jsx("button",{onClick:()=>E(!A),className:"w-full bg-blue-500 text-white font-semibold py-2 rounded-md hover:bg-blue-600 transition mb-4",children:A?`- ${t.close_add_book_button}`:`+ ${t.add_book_button}`}),A&&e.jsxs("form",{onSubmit:me,className:"mb-4",children:[e.jsx("input",{type:"text",value:p,onChange:n=>g(n.target.value),placeholder:t.placeholder_book_title,className:"input mb-2 w-full border border-gray-300 rounded-md py-2 px-4"}),e.jsx("input",{type:"text",value:f,onChange:n=>v(n.target.value),placeholder:t.placeholder_book_author,className:"input mb-2 w-full border border-gray-300 rounded-md py-2 px-4"}),e.jsx("textarea",{value:M,onChange:n=>C(n.target.value),onInput:n=>{n.target.style.height="auto",n.target.style.height=`${n.target.scrollHeight}px`},placeholder:t.placeholder_book_description,className:"input mb-2 w-full border border-gray-300 rounded-md py-2 px-4"}),e.jsx("input",{type:"number",value:b,onChange:n=>m(n.target.value),placeholder:t.placeholder_book_year,className:"input mb-2 w-full border border-gray-300 rounded-md py-2 px-4"}),e.jsxs("select",{value:Q,onChange:n=>P(n.target.value),className:"input mb-2 w-full border border-gray-300 rounded-md py-2 px-4",children:[e.jsx("option",{value:"",children:t.select_cover_type}),oe.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))]}),e.jsx("input",{type:"number",value:x,onChange:n=>B(n.target.value),placeholder:t.placeholder_book_pages,className:"input mb-2 w-full border border-gray-300 rounded-md py-2 px-4"}),e.jsx("input",{type:"number",value:y,onChange:n=>c(n.target.value),placeholder:t.placeholder_book_recommended_age,className:"input mb-2 w-full border border-gray-300 rounded-md py-2 px-4"}),e.jsxs("select",{value:S,onChange:n=>j(n.target.value),className:"input mb-2 w-full border border-gray-300 rounded-md py-2 px-4",children:[e.jsx("option",{value:"",children:t.select_condition}),ae.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))]}),e.jsxs("select",{value:w,onChange:n=>k(n.target.value),className:"input mb-2 w-full border border-gray-300 rounded-md py-2 px-4",children:[e.jsx("option",{value:"",children:t.select_parent}),F.map(n=>e.jsx("option",{value:n.parent_name,children:n.parent_name},n.id))]}),e.jsx("button",{type:"submit",className:"w-full bg-green-500 text-white font-semibold py-2 rounded-md hover:bg-green-600 transition",children:L?t.update_book_button:t.add_book_button})]}),e.jsxs("div",{className:`w-full border-b border-gray-300 bg-gray-100 py-2 px-4 flex ${d==="he"?"flex-row-reverse":"flex-row"} justify-between items-center cursor-pointer`,onClick:()=>u(a==="desc"?"asc":"desc"),"aria-label":t.sort_by,children:[e.jsx("span",{className:"font-semibold text-gray-700",children:t.title}),a==="desc"?e.jsx(je,{size:20}):e.jsx(Ne,{size:20})]}),e.jsx("div",{dir:$,children:e.jsx("div",{className:"overflow-y-auto max-h-screen border-t pt-4",children:r.filter(n=>n.title.toLowerCase().includes(R.toLowerCase())||n.author.toLowerCase().includes(R.toLowerCase())).map(n=>e.jsxs("div",{className:"bg-gray-50 shadow-sm rounded-lg p-4 mb-2 relative",children:[e.jsxs("div",{className:"mb-12",children:[e.jsx("h2",{className:"font-bold text-gray-800",children:n.title}),e.jsx("p",{className:"text-sm text-gray-500",children:n.author}),e.jsxs("p",{className:"text-sm mb-4",children:[e.jsx("span",{className:n.loan_status==="available"?"text-green-500":"text-red-500",children:n.loan_status==="borrowed"?t.borrowed:t.available}),n.loan_status==="borrowed"&&e.jsxs("span",{children:[" ",t.by," ",n.borrowing_child]})]}),e.jsx("button",{onClick:()=>le(`${n.qr_code}`),className:"text-blue-600 text-sm px-3 py-1 rounded-md border border-blue-600 hover:bg-blue-50 transition-colors duration-200",children:t.download_qr_code})]}),e.jsxs("div",{className:"absolute bottom-4 inset-x-4 flex justify-between items-center",children:[e.jsx("button",{onClick:()=>he(n),className:"p-2 text-gray-600 hover:text-emerald-600 transition-colors duration-200","aria-label":t.edit_book,children:e.jsx(Ee,{size:20})}),e.jsx("button",{onClick:()=>pe(n.qr_code),className:"flex items-center gap-1 text-gray-600 hover:text-indigo-600 transition-colors duration-200",children:G[n.qr_code]?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm",children:t.Hide_Details}),e.jsx(Ne,{size:20})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm",children:t.More_Details}),e.jsx(je,{size:20})]})}),e.jsx("div",{className:"w-8","aria-hidden":"true"})]}),G[n.qr_code]&&e.jsxs("div",{className:"mt-8 mb-8 text-gray-600 bg-white p-4 rounded-md border border-gray-100",children:[e.jsxs("p",{children:[e.jsxs("strong",{children:[t.description,":"]})," ",n.description||"N/A"]}),e.jsxs("p",{children:[e.jsxs("strong",{children:[t.year_of_publication,":"]})," ",n.year_of_publication||"N/A"]}),e.jsxs("p",{children:[e.jsxs("strong",{children:[t.cover_type,":"]})," ",ar(n.cover_type,t)]}),e.jsxs("p",{children:[e.jsxs("strong",{children:[t.pages,":"]})," ",n.pages||"N/A"]}),e.jsxs("p",{children:[e.jsxs("strong",{children:[t.recommended_age,":"]})," ",n.recommended_age||"N/A"]}),e.jsxs("p",{children:[e.jsxs("strong",{children:[t.select_condition,":"]})," ",nr(n.book_condition,t)]}),e.jsxs("p",{children:[e.jsxs("strong",{children:[t.delivering_parent,":"]})," ",n.delivering_parent||"N/A"]})]})]},n.qr_code))})})]})};function fr(){const[r,s]=l.useState([]),[a,u]=l.useState(""),[p,g]=l.useState(""),[f,v]=l.useState(""),[M,C]=l.useState(!1),[b,m]=l.useState(""),[x,B]=l.useState({}),[Q,P]=l.useState(""),{language:S,toggleLanguage:j,direction:y}=J(),c=Z(S),[q,w]=l.useState(null),[k,F]=l.useState(null),[D,A]=l.useState({}),E=()=>{const t={};return a.trim()||(t.parentName=c.error_parent_name_required),p.trim()||(t.kidName=c.error_kid_name_required),f.trim()&&!/\S+@\S+\.\S+/.test(f)&&(t.email=c.error_email_invalid),B(t),Object.keys(t).length===0},R=async t=>{if(t.preventDefault(),!!E()){f.trim()||alert(c.email_missing_warning);try{const L={parent_name:a,kid_name:p,email:f};q?await ur(q,L):await cr(L),w(null),u(""),g(""),v(""),B({}),P(q?c.success_member_updated:c.success_member_added),await z()}catch(L){console.error("Error saving member:",L),P("")}}},U=async t=>{if(window.confirm(c.confirm_delete_member))try{await mr(t),P(c.success_member_deleted),await z()}catch(L){console.error("Error deleting member:",L),alert("Cannot delete member: they have open loans.")}},G=t=>{w(t.id),u(t.parent_name),g(t.kid_name),v(t.email),C(!0)},z=async()=>{try{const t=await qe();Array.isArray(t)?s(t):(console.error("Unexpected response format:",t),s([]))}catch(t){console.error("Failed to load members:",t),s([])}};l.useEffect(()=>{z()},[]);const d=async t=>{if(k===t)F(null);else if(F(t),!D[t])try{const L=await dr(t);A(W=>({...W,[t]:L}))}catch(L){console.error("Error fetching loans:",L)}},$=[...Array.isArray(r)?r.filter(t=>t.parent_name.toLowerCase().includes(b.toLowerCase())||t.kid_name.toLowerCase().includes(b.toLowerCase())):[]].sort((t,L)=>{const W=t.borrowed_books_count||0,h=L.borrowed_books_count||0;return W>2&&h<=2?-1:h>2&&W<=2?1:0});return e.jsxs("div",{className:"w-full max-w-md mx-auto",children:[e.jsx("button",{onClick:()=>C(!M),className:"w-full bg-blue-500 text-white font-semibold py-2 rounded-md hover:bg-blue-600 transition mb-4",children:M?`- ${c.close_add_member_button}`:`+ ${c.add_member_button}`}),M&&e.jsxs("form",{onSubmit:R,className:"mb-4",children:[e.jsx("input",{type:"text",placeholder:c.parent_name_placeholder,value:a,onChange:t=>u(t.target.value),className:"input mb-2 w-full border border-gray-300 rounded-md py-2 px-4"}),x.parentName&&e.jsx("p",{className:"text-red-500 text-sm",children:x.parentName}),e.jsx("input",{type:"text",placeholder:c.kid_name_placeholder,value:p,onChange:t=>g(t.target.value),className:"input mb-2 w-full border border-gray-300 rounded-md py-2 px-4"}),x.kidName&&e.jsx("p",{className:"text-red-500 text-sm",children:x.kidName}),e.jsx("input",{type:"email",placeholder:c.email_placeholder,value:f,onChange:t=>v(t.target.value),className:"input mb-2 w-full border border-gray-300 rounded-md py-2 px-4"}),x.email&&e.jsx("p",{className:"text-red-500 text-sm",children:x.email}),e.jsx("button",{type:"submit",className:"w-full bg-green-500 text-white font-semibold py-2 rounded-md hover:bg-green-600 transition",children:c.add_member_button}),Q&&e.jsx("p",{className:"text-green-500 text-sm mt-2",children:Q})]}),e.jsx("input",{type:"text",placeholder:c.search_placeholder,value:b,onChange:t=>m(t.target.value),className:`input w-full border border-gray-300 rounded-md py-2 px-4 mb-4 ${S==="he"?"text-right":"text-left"} ${S==="he"?"rtl":"ltr"}`}),e.jsx("div",{dir:y,children:e.jsx("div",{className:"overflow-y-auto max-h-96 border-t pt-4",children:$.map(t=>e.jsxs("div",{className:"bg-gray-50 shadow-sm rounded-lg p-4 mb-2 relative",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("h2",{className:"font-bold text-gray-800",children:[c.parent_name_label,": ",t.parent_name]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[c.kid_name_label,": ",t.kid_name]}),e.jsxs("p",{className:"text-sm mb-2  text-gray-500",children:[c.email_label,": ",t.email||c.no_email_provided]}),e.jsxs("p",{className:`text-sm mb-2 mt-2 font-semibold ${t.borrowed_books_count>2?"text-red-500":"text-gray-700"}`,children:[c.borrowed_books_label,": ",t.borrowed_books_count]}),k===t.id&&D[t.id]&&e.jsxs("div",{className:"mt-2 p-2 bg-gray-100 rounded",children:[e.jsx("h3",{className:"font-semibold text-gray-700",children:c.borrowed_books_label}),e.jsx("ul",{children:D[t.id].map((L,W)=>e.jsxs("li",{className:"text-sm text-gray-600",children:["- ",L.book_title," (",c.borrow_date,": ",new Date(L.borrowed_at).toLocaleDateString(),")"]},W))})]})]}),e.jsx("div",{className:"absolute bottom-4 inset-x-4 flex justify-between items-center",children:e.jsxs("div",{className:"flex gap-2",children:[t.borrowed_books_count>0?e.jsxs("button",{onClick:()=>alert(c.cannot_delete_with_borrowed_books),className:"text-gray-400 cursor-not-allowed relative","aria-label":c.cannot_delete_with_borrowed_books,children:[e.jsx(ke,{size:20}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:"w-[28px] h-[2px] bg-gray-400 rotate-45 absolute"})})]}):e.jsx("button",{onClick:()=>U(t.id),className:"text-gray-600 hover:text-red-600 transition-colors duration-200","aria-label":c.delete_member,children:e.jsx(ke,{size:20})}),e.jsx("button",{onClick:()=>G(t),className:"text-gray-600 hover:text-emerald-600 transition-colors duration-200","aria-label":c.edit_member,children:e.jsx(Ee,{size:20})}),t.borrowed_books_count>0&&e.jsx("button",{onClick:()=>d(t.id),className:"text-gray-600 hover:text-blue-600 transition-colors duration-200","aria-label":c.More_Details,children:e.jsx(Ie,{size:20})})]})})]},t.id))})})]})}async function _e(){return await(await X.get(`${V}/api/available_books`)).data}async function xe(){try{const r=await X.get(`${V}/api/borrowed_books`);return console.log("Borrowed Books Response:",r.data),r.data}catch(r){throw console.error("Error fetching borrowed books:",r.response||r),r}}async function yr(r){return await(await X.get(`${V}/api/book/${r}`)).data}async function wr(){const r=await I.get("/api/members");return console.log("API Response:",r.data),r.data.members||r.data}const vr=async(r,s,a)=>{try{return(await I.post("/api/book/borrow",{qr_code:r,member_id:s,book_state:a})).data}catch(u){throw console.error("Error borrowing book:",u.response||u),u}},jr=async r=>{try{return(await I.post("/api/book/return",{qr_code:r})).data}catch(s){throw console.error("Error returning book:",s),s}};async function te(r,s){return(await X.get(`${V}/api/loans/history`,{params:{qr_code:r||"",show_all:s?"true":"false"}})).data}const Nr=async(r,s,a,u="en")=>{var p,g;try{return(await I.post("/api/send-reminder",{loan_id:r,subject:s,loan_details:a,language:u})).data}catch(f){return console.error(`Error sending reminder for loan_id ${r}:`,f),{success:!1,error:((g=(p=f.response)==null?void 0:p.data)==null?void 0:g.error)||f.message||"Unknown error"}}},Be=async r=>{try{const s=await X.get(`${V}/api/reminders/last/${r}`),{sent_at:a}=s.data;return{sent_at:a}}catch(s){return console.error(`Error fetching last reminder for loan_id ${r}:`,s),null}},kr=({onScanSuccess:r,onScanError:s,onScanCancel:a})=>{const[u,p]=l.useState(!1),[g,f]=l.useState(""),[v,M]=l.useState(0),{language:C}=J(),b=Z(C),m=async(j,y,c={},q)=>{try{const w=await j.scanFile(y,!0,c);return console.log(`Scan attempt ${q} succeeded:`,w),w}catch(w){console.log(`Scan attempt ${q} failed:`,w);const k=x(w);throw new Error(k)}},x=j=>{const y=(j==null?void 0:j.message)||b.error_scanning;return y.includes("No barcode or QR code found")?b.qr_error_no_code||"No QR code detected. Please try again.":y.includes("BarCodeDetector not supported")?b.qr_error_no_support||"Your browser doesn't support QR scanning.":y.includes("timeout")?b.qr_error_timeout||"Scanning timed out. Try using a smaller image.":y.includes("unable to parse")?b.qr_error_unreadable||"The QR code is unclear or damaged.":y.includes("file too large")?b.qr_error_large_file||"The image file is too large.":`${b.error_scanning}: ${y}`},B=async j=>{const y=j.target.files[0];if(!y)return;console.log("File details:",y.name,y.type,y.size),console.log("File last modified:",new Date(y.lastModified).toISOString()),p(!0),f(""),M(0);const c=new Ve("qr-reader"),q=/iPhone|iPad|iPod/i.test(navigator.userAgent),w=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);console.log("Device detection - iOS:",q,"Safari:",w);try{const k=await Q(y,q),F=q?[{formatsToSupport:[be.QR_CODE],experimentalFeatures:{useBarCodeDetectorIfSupported:!1}},{formatsToSupport:[be.QR_CODE],experimentalFeatures:{useBarCodeDetectorIfSupported:!0}},{}]:[{experimentalFeatures:{useBarCodeDetectorIfSupported:!0}},{formatsToSupport:[be.QR_CODE]},{}];let D=!1,A=[];for(let E=0;E<F.length;E++)try{console.log(`Attempting scan with config ${E+1}:`,F[E]),M(E+1);const R=k||y;console.log("Scanning file:",R.name,R.type,R.size);const U=await m(c,R,F[E],E+1);if(U){D=!0;try{await c.clear()}catch(G){console.warn("Error clearing scanner:",G)}r(U);break}}catch(R){console.log(`Config ${E+1} failed:`,R),A.push(R.message)}if(!D){const E=[...new Set(A)],R=E.length>0?E[0]:"Failed to scan QR code. Please try a different image with better lighting and focus.";f(R)}}catch(k){console.error("Final error:",k);const F=x(k);f(F)}finally{try{await c.clear()}catch(k){console.error("Error clearing scanner:",k)}p(!1)}},Q=async(j,y)=>j.type.startsWith("image/")&&j.size>1024*1024?new Promise((c,q)=>{try{const w=new Image,k=document.createElement("canvas"),F=k.getContext("2d");w.onload=()=>{let D=w.width,A=w.height;const E=1200;D>A&&D>E?(A=Math.round(A*E/D),D=E):A>E&&(D=Math.round(D*E/A),A=E),k.width=D,k.height=A,F.drawImage(w,0,0,D,A),k.toBlob(R=>{if(R){const U=new File([R],j.name,{type:"image/jpeg",lastModified:Date.now()});console.log("Resized image from",j.size,"to",U.size,"bytes"),c(U)}else console.warn("Failed to create blob from canvas"),c(null)},"image/jpeg",.95)},w.onerror=()=>{console.warn("Failed to load image for resizing"),c(null)},w.src=URL.createObjectURL(j)}catch(w){console.error("Error resizing image:",w),c(null)}}):null,P=()=>{f("")},S=()=>{s(new Error(g))};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg max-w-md w-full",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:b.ScanQR}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{id:"qr-reader",style:{display:"none"}}),g?e.jsxs("div",{className:"text-center text-red-500 p-3 border border-red-200 rounded bg-red-50 mb-4",children:[e.jsx("p",{className:"font-medium mb-2",children:b.error_scanning}),e.jsx("p",{className:"text-sm mb-3",children:g}),e.jsx("p",{className:"text-xs mb-3 text-gray-600",children:b.qr_error_tips}),e.jsxs("div",{className:"flex space-x-2 mt-2",children:[e.jsx("button",{onClick:P,className:"flex-1 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded text-sm",children:b.qr_try_again||"Try Again"}),e.jsx("button",{onClick:S,className:"flex-1 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded text-sm",children:b.qr_cancel||"Cancel"})]})]}):e.jsx("div",{className:"flex flex-col items-center",children:e.jsxs("label",{className:"w-full flex flex-col items-center px-4 py-6 bg-coral text-blue rounded-lg shadow-lg tracking-wide uppercase border border-blue cursor-pointer hover:bg-blue hover:text-white",children:[e.jsx("span",{className:"mt-2 text-base leading-normal",children:b.qr_select_image||"Select an image"}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",capture:"environment",onChange:B,disabled:u})]})}),u&&e.jsxs("div",{className:"text-center text-gray-600",children:[b.processing_image||"Processing image...","  ",v>0&&`(Attempt ${v})`]}),!g&&e.jsx("button",{onClick:a,className:"w-full mt-4 px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300",children:b.qr_cancel||"Cancel"})]})]})})},H={coral:"#F38181",teal:"#4ECAC7",yellow:"#FEC43C"};function Sr(){const[r,s]=l.useState(""),[a,u]=l.useState([]),[p,g]=l.useState([]),[f,v]=l.useState(""),[M,C]=l.useState(""),[b,m]=l.useState(null),[x,B]=l.useState(""),[Q,P]=l.useState([]),[S,j]=l.useState(""),[y,c]=l.useState(null);l.useState([]);const[q,w]=l.useState([]),[k,F]=l.useState(!1),[D,A]=l.useState(!1),[E,R]=l.useState(!1),[U,G]=l.useState(!1),[z,d]=l.useState([]),[T,$]=l.useState(!1),{language:t,toggleLanguage:L,direction:W}=J(),h=Z(t),[O,oe]=l.useState(!0);l.useEffect(()=>{(async()=>{try{const[i,_,N]=await Promise.all([wr(),_e(),xe()]);u(i),g(_),P(N)}catch(i){console.error("Error loading initial data:",i)}})()},[]),l.useEffect(()=>{(async()=>{try{let i=null;r==="return"?i=S||null:r==="borrow"&&(i=M||null);const _=await te(i,k),N=await Promise.all(_.map(async Y=>{try{const re=await Be(Y.id);return{...Y,last_reminder_date:re?re.sent_at:null}}catch(re){return console.error(`Failed to fetch reminder for loan_id ${Y.id}:`,re),{...Y,last_reminder_date:null}}}));w(ie(N))}catch(i){console.error("Error fetching loan history:",i),w([])}})()},[k,r,S,M]),l.useEffect(()=>{m(null),C(""),c(null),j(""),B(""),v(null)},[r]);const ae=a.map(o=>({value:o.id,label:O?o.parent_name:o.kid_name,parentName:o.parent_name,childName:o.kid_name})),ne=p.map(o=>({value:o.qr_code,label:o.title})),ue=o=>{if(!o.returned_at){const i=Q.find(_=>_.id===o.book_id);i?(c(i),j(i.qr_code),m(i),B(i.delivery_status||""),window.scrollTo({top:0,behavior:"smooth"})):alert("Book not found in borrowed books.")}},me=(o,i)=>{o.stopPropagation(),o.target.checked?d([...z,i]):d(z.filter(_=>_.id!==i.id))},he=async()=>{$(!0);try{const o=await Promise.all(z.map(async N=>{try{const Y=await Nr(N.id,"Book Return Reminder",{borrower_name:N.borrower_name,book_title:N.book_title,borrowed_at:N.borrowed_at},t);if(Y.success){console.log(`Reminder sent successfully for loan_id: ${N.id}`);const re=new Date().toISOString().slice(0,19).replace("T"," ");w(ge=>ge.map(ee=>ee.id===N.id?{...ee,last_reminder_date:re}:ee));const ce=await Be(N.id);ce!=null&&ce.sent_at&&w(ge=>ge.map(ee=>ee.id===N.id?{...ee,last_reminder_date:ce.sent_at}:ee))}else console.error(`Failed to send reminder for loan_id: ${N.id} - ${Y.error}`);return{success:Y.success,loanId:N.id,error:Y.error}}catch(Y){return console.error(`Error sending reminder for loan_id ${N.id}:`,Y),{success:!1,loanId:N.id,error:Y.message}}})),i=o.filter(N=>N.success).length,_=o.filter(N=>!N.success);if(i>0&&alert(`Sent ${i} reminders successfully!`),_.length>0){const N=_.map(Y=>`Loan ID: ${Y.loanId} - ${Y.error}`).join(`
`);alert(`Failed to send ${_.length} reminders.

${N}`)}d([]),G(!1)}catch(o){console.error("Failed to send reminders:",o),alert("Failed to send reminders. Please check your email service configuration.")}finally{$(!1)}},pe=async o=>{const i=o.target.checked;F(i);try{let _=null;r==="return"?_=S||null:r==="borrow"&&(_=M||null);const N=await te(_,i);w(ie(N))}catch(_){console.error("Error fetching loan history:",_),w([])}},le=async()=>{R(!0),A(!0)},n=async o=>{try{console.log("Handling scan result..."),A(!1),R(!0);const i=await yr(o);if(i)if(r==="borrow"?(C(o),m(i)):r==="return"&&(j(o),c(i),m(i),c(i)),B(i.delivery_status),i.loan_status==="borrowed"){const _=await te(o);if(_&&_.length>0){const N=_[0];alert(`The book "${i.title}" was borrowed by ${N.borrower_name} on ${N.borrowed_at}.`)}else alert(`The book "${i.title}" is marked as borrowed, but no loan history is available.`)}else alert(`The book "${i.title}" is available.`);else alert("Book not found for the given QR code.")}catch(i){console.error("Error processing scan result:",i),alert("An error occurred while processing the QR code.")}finally{R(!1)}},K=o=>{console.error("QR Scan Error:",o),A(!1),R(!1),alert("Failed to scan QR code. Please try again.")},Ae=()=>{A(!1),R(!1)},$e=async()=>{if(f&&b&&x)try{if((await vr(b.qr_code,f.id,x)).message){alert("Book borrowed successfully!"),m(null),v(null),B("");const i=await _e(),_=await xe(),N=await te(null,k);g(i),P(_),w(ie(N))}else alert("Error borrowing book.")}catch(o){console.error("Failed to borrow book:",o)}else alert("Please select a borrower, book, and book state.")},De=async()=>{if(!S){alert("Please select a book to return.");return}try{if((await jr(S)).success){alert("Book returned successfully!"),c(null),j(""),m(null),B("");const i=await _e(),_=await xe(),N=await te(null,k);g(i),P(_),w(ie(N))}else alert("Failed to return the book. Please try again.")}catch(o){console.error("Error returning book:",o),alert("An error occurred while returning the book. Please try again.")}},ie=o=>o.sort((i,_)=>!i.return_date&&_.return_date?-1:i.return_date&&!_.return_date?1:new Date(_.loan_start_date)-new Date(i.loan_start_date));return e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-6",children:[D&&e.jsx("div",{className:"scanner-modal",children:e.jsx(kr,{onScanSuccess:n,onScanError:K,onScanCancel:Ae})}),e.jsxs("div",{className:"flex gap-4 mb-4",children:[e.jsx("button",{className:`flex-1 py-2 px-4 rounded ${r==="borrow"?"text-white":"text-gray-800"}`,style:{backgroundColor:r==="borrow"?H.coral:"transparent",borderColor:H.coral,borderWidth:"1px"},onClick:()=>s("borrow"),children:h.borrow}),e.jsx("button",{className:`flex-1 py-2 px-4 rounded ${r==="return"?"text-white":"text-gray-800"}`,style:{backgroundColor:r==="return"?H.coral:"transparent",borderColor:H.coral,borderWidth:"1px"},onClick:()=>s("return"),children:h.return})]}),r==="borrow"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ce,{options:ae,placeholder:O?h.parent_name_placeholder:h.kid_name_placeholder,value:f?{value:f.id,label:O?f.parent_name:f.kid_name}:null,onChange:o=>{if(o){const i=a.find(_=>_.id===o.value||_.parent_name===o.label||_.kid_name===o.label);v(i||null)}else v(null)},isClearable:!0,styles:{control:o=>({...o,textAlign:t==="he"?"right":"left",direction:t==="he"?"rtl":"ltr",borderColor:H.coral,borderRadius:"4px",boxShadow:"none","&:hover":{borderColor:H.teal}})},className:"w-full flex-grow",classNamePrefix:"borrower-select"}),e.jsx("button",{onClick:()=>oe(!O),className:`relative inline-flex h-6 w-16 items-center rounded-full transition-colors duration-200 ease-in-out ${O?"bg-teal-600":"bg-gray-200"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-gray-300 transition duration-200 ease-in-out ${O?"translate-x-6":"translate-x-1"}`})}),e.jsx("span",{className:"text-sm text-gray-600",children:O?h.parent_name_borrower:h.kid_name_borrower})]}),e.jsx(Ce,{options:ne,placeholder:h.Select_Book,value:b?{value:b.qr_code,label:b.title}:null,onChange:o=>{const i=p.find(_=>_.qr_code===(o==null?void 0:o.value));m(i||null),C((o==null?void 0:o.value)||""),B((i==null?void 0:i.delivery_status)||"")},isClearable:!0,styles:{control:o=>({...o,textAlign:t==="he"?"right":"left",direction:t==="he"?"rtl":"ltr",borderColor:H.coral,borderRadius:"4px",boxShadow:"none","&:hover":{borderColor:H.teal}})},className:"w-full",classNamePrefix:"book-select"}),b&&e.jsxs("div",{className:`bg-gray-100 p-4 rounded mt-4 ${t==="he"?"rtl":""}`,children:[e.jsx("h3",{className:"font-bold text-lg",children:b.title}),e.jsxs("p",{className:"text-sm",children:[h.author,": ",b.author]}),e.jsxs("p",{className:"text-sm",children:[h.description,": ",b.description]}),e.jsxs("p",{className:"text-sm",children:[h.year_of_publication,": ",b.year_of_publication]}),e.jsxs("p",{className:"text-sm",children:[h.cover_type,": ",b.cover_type]}),e.jsxs("p",{className:"text-sm",children:[h.pages,": ",b.pages]}),e.jsxs("p",{className:"text-sm",children:[h.recommended_age,": ",b.recommended_age]}),e.jsxs("p",{className:"text-sm",children:[h.Select_Book_State,": ",b.book_condition]})]}),b&&e.jsxs("select",{className:"w-full p-2 border rounded mt-2",style:{borderColor:H.coral},onChange:o=>B(o.target.value),value:x,children:[e.jsx("option",{value:"",children:h.Select_Book_State}),e.jsx("option",{value:"כמו חדש",children:h.new}),e.jsx("option",{value:"מצויין - בלאי בלתי מורגש",children:h.good}),e.jsx("option",{value:"טוב - בלאי קל",children:h.worn})]}),e.jsxs("button",{className:"w-full flex items-center justify-center py-2 px-4 rounded text-white",style:{backgroundColor:H.coral},onClick:le,children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),h.ScanQR]}),e.jsx("button",{className:"w-full py-2 px-4 rounded text-white mt-2",style:{backgroundColor:H.coral},onClick:$e,children:h.borrow}),e.jsx("div",{className:`loan-history-container ${t==="he"?"rtl":""}`,children:p.map(o=>e.jsxs("div",{className:`loan-history-card ${(b==null?void 0:b.qr_code)===o.qr_code?"active-loan":""} ${t==="he"?"rtl":""}`,onClick:()=>{m(o),C(o.qr_code),B(o.delivery_status||"")},style:{cursor:"pointer"},children:[e.jsx("div",{className:"loan-history-card-header",children:e.jsx("h3",{className:"loan-history-card-title",children:o.title})}),e.jsxs("div",{className:"loan-history-card-body",children:[e.jsxs("p",{className:"loan-history-card-detail",children:[h.author,": ",o.author]}),e.jsxs("p",{className:"loan-history-card-detail",children:[h.year_of_publication,": ",o.year_of_publication]}),e.jsxs("p",{className:"loan-history-card-detail",children:[h.pages,": ",o.pages]}),e.jsxs("p",{className:"loan-history-card-detail",children:[h.recommended_age,": ",o.recommended_age]})]})]},o.qr_code))})]}),r==="return"&&e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"mt-4",children:e.jsxs("select",{value:S||"",onChange:o=>{const i=o.target.value;j(i);const _=Q.find(N=>N.qr_code===i);_?(c(_),m(_),B(_.delivery_status||"")):c(null)},className:"w-full p-2 border rounded",style:{borderColor:H.coral,textAlign:t==="he"?"right":"left",direction:t==="he"?"rtl":"ltr"},children:[e.jsx("option",{value:"",children:h.Select_Book}),Q.map(o=>e.jsx("option",{value:o.qr_code,children:o.title},o.qr_code))]})}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("button",{className:"w-full flex items-center justify-center py-2 px-4 rounded text-white",style:{backgroundColor:H.coral},onClick:le,children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),h.ScanQR]}),e.jsx("button",{className:"w-full py-2 px-4 rounded text-white mt-2",style:{backgroundColor:H.coral},onClick:De,disabled:!y,children:h.return}),e.jsxs("button",{className:"w-full flex items-center justify-center py-2 px-4 rounded text-white mt-2",style:{backgroundColor:H.teal},onClick:()=>G(!U),children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),h.SendReminders]})]}),e.jsx("div",{className:"flex items-center my-4",children:e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:o=>pe({target:{checked:!k}}),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors duration-200 ease-in-out ${k?"bg-teal-600":"bg-gray-200"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition duration-200 ease-in-out ${k?"translate-x-6":"translate-x-1"}`})}),e.jsx("span",{className:"text-sm text-gray-600",children:h.ShowAllLoans})]})}),U&&q.filter(o=>!o.returned_at).length>0&&e.jsxs("div",{className:"reminder-section bg-gray-100 p-4 rounded-lg mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:h.SendReminders}),e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:z.length===q.filter(o=>!o.returned_at).length,onChange:o=>{if(o.target.checked){const i=q.filter(_=>!_.returned_at);d(i)}else d([])},className:"w-4 h-4 text-teal-500 border-gray-300 rounded focus:ring-teal-500 cursor-pointer"}),e.jsx("span",{className:"ml-2",children:h.select_all})]})]}),e.jsx("button",{className:"w-full py-2 px-4 rounded text-white",style:{backgroundColor:H.coral},onClick:he,disabled:z.length===0||T,children:T?h.sending_reminders:h.send_x_reminders.replace("{count}",z.length)})]}),q.length>0&&e.jsx("div",{className:`loan-history-container ${t==="he"?"rtl":""}`,children:q.map(o=>e.jsxs("div",{className:`loan-history-card ${o.returned_at?"":"active-loan"} ${t==="he"?"rtl":""}`,onClick:()=>r==="return"&&ue(o),children:[e.jsxs("div",{className:"loan-history-card-header",children:[U&&!o.returned_at&&e.jsx("div",{onClick:i=>i.stopPropagation(),children:e.jsxs("label",{className:"custom-checkbox",children:[e.jsx("input",{type:"checkbox",checked:z.some(i=>i.id===o.id),onChange:i=>me(i,o),className:"hidden-checkbox"}),e.jsx("span",{className:"checkbox-mark"})]})}),e.jsx("div",{className:"loan-history-card-title",children:o.book_title})]}),e.jsxs("div",{className:"loan-history-card-body",children:[e.jsxs("div",{className:"loan-history-card-detail",children:[h.borrowed_by," ",o.borrower_name]}),e.jsxs("div",{className:"loan-history-card-detail",children:[h.kid_name_borrower,": ",o.borrower_child||"N/A"]}),e.jsxs("div",{className:"loan-history-card-detail",children:[h.borrow_date,": ",o.borrowed_at]}),o.returned_at&&e.jsxs("div",{className:"loan-history-card-detail",children:[h.return_date,": ",o.returned_at]}),e.jsxs("div",{className:"loan-history-card-detail",children:[h.delivery_status,": ",o.book_state||"N/A"]}),o.last_reminder_date?e.jsxs("div",{className:"loan-history-card-detail",children:[h.last_reminder,": ",o.last_reminder_date]}):e.jsx("div",{className:"loan-history-card-detail no-reminder",children:h.no_reminder_sent})]})]},o.id))})]})]})}const ve=navigator.language||"en-US",Cr=async(r="desc",s="title",a=!0)=>{try{const u=new URLSearchParams({order_by:r,sort_column:s,include_history:a.toString()});return(await I.get(`/api/generate_books_report?${u.toString()}`,{headers:{"Accept-Language":ve},responseType:"blob"})).data}catch(u){throw console.error("Error generating books report:",u),u}},Br=async(r="desc",s="title",a=!1)=>{try{const u=new URLSearchParams({order_by:r,sort_column:s,include_borrowed:a.toString()});return(await I.get(`/api/generate_inventory_report?${u.toString()}`,{headers:{"Accept-Language":ve},responseType:"blob"})).data}catch(u){throw console.error("Error generating inventory report:",u),u}},Er=async()=>{try{return(await I.get("/api/qr_codes_with_titles")).data}catch(r){throw console.error("Error fetching QR codes with titles:",r),r}},Lr=async r=>{try{const s={selected_qr_codes:r};return(await I.post("/api/reports/qr_codes",s,{headers:{"Accept-Language":ve},responseType:"blob"})).data}catch(s){throw console.error("Error generating QR codes report:",s),s}},Rr=()=>{const{language:r,toggleLanguage:s}=J(),a=Z(r),[u,p]=l.useState(!1),[g,f]=l.useState(!0),[v,M]=l.useState("desc"),[C,b]=l.useState(""),[m,x]=l.useState(""),[B,Q]=l.useState([]),[P,S]=l.useState(!0),[j,y]=l.useState([]),[c,q]=l.useState("qr_code"),[w,k]=l.useState(!0),F={inventory:[{value:"title",label:a.book_title},{value:"author",label:a.author},{value:"id",label:a.id},{value:"loan_status",label:a.loan_status}],loans:[{value:"title",label:a.book_title},{value:"author",label:a.author},{value:"id",label:a.id}]};l.useEffect(()=>{m==="qr_codes"&&Er().then(d=>{const T=d.map($=>({...$,selected:!0}));y(T)}).catch(d=>{console.error(d),y([])})},[m]),l.useEffect(()=>{if(m==="qr_codes"){const d=D(j,c,w);Q(d)}},[j,c,w,m]);function D(d,T,$){const t=[...d];return t.sort((L,W)=>{if(T==="qr_code"){const h=z(L.qr_code),O=z(W.qr_code);return $?h-O:O-h}else if(T==="title"){const h=(L.title||"").toLowerCase(),O=(W.title||"").toLowerCase();return h<O?$?-1:1:h>O?$?1:-1:0}return 0}),t}const A=d=>{Q(T=>{const $=T.map(t=>({...t}));return $[d].selected=!$[d].selected,$})},E=()=>{const d=!P;S(d),Q(T=>T.map($=>({...$,selected:d})))},R=()=>m?m==="inventory"||m==="loans"?!C:m==="qr_codes"?!B.some(d=>d.selected):!1:!0,U=async()=>{try{let d;if(m==="inventory")d=await Br(v,C,g);else if(m==="loans")d=await Cr(v,C,u);else if(m==="qr_codes"){const t=B.filter(L=>L.selected).map(L=>L.qr_code);if(t.length===0){alert("No QR codes selected!");return}d=await Lr(t)}const T=window.URL.createObjectURL(new Blob([d])),$=document.createElement("a");$.href=T,$.setAttribute("download",`${m}_report.${m==="qr_codes"?"pdf":"xlsx"}`),document.body.appendChild($),$.click()}catch(d){console.error("Error generating report:",d),alert(a.error_generating_report||"Error generating report.")}},G=d=>{c===d?k(!w):(q(d),k(!0))};function z(d){const T=d.match(/\d+$/);return T?parseInt(T[0],10):0}return e.jsx("div",{className:`report-container ${r==="he"?"rtl":""}`,dir:r==="he"?"rtl":"ltr",children:e.jsxs("div",{className:"p-4 bg-white rounded-lg shadow-md",children:[e.jsxs("div",{className:"flex items-center justify-center mb-4",children:[e.jsx(ze,{className:"w-6 h-6 mr-2 text-teal-500"}),e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:a.reports})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border-gray-200 border-1",dir:r==="he"?"rtl":"ltr",children:[e.jsxs("h3",{className:"text-md font-semibold text-teal-600 mb-3 flex items-center",children:[e.jsx(Oe,{className:`w-4 h-4 ${r==="he"?"ml-2":"mr-2"}`}),a.report_type_title||a.select_report_type]}),e.jsx("div",{className:"space-y-2",children:["inventory","loans","qr_codes"].map(d=>e.jsx("button",{onClick:()=>x(d),className:`w-full p-2 rounded-lg ${r==="he"?"text-right":"text-left"} text-sm ${m===d?"bg-teal-500 text-white shadow-md":"bg-white text-gray-700 hover:bg-gray-100 border border-gray-200"}`,children:d==="inventory"?a.inventory_report:d==="loans"?a.loans_report:a.qr_codes_report||"QR Codes PDF"},d))})]}),e.jsx("div",{className:`bg-gray-100 p-4 rounded-lg border border-gray-300 ${m?"":"opacity-50 pointer-events-none"}`,children:m&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-md font-semibold text-teal-600 mb-3 flex items-center",children:[e.jsx(He,{className:`w-4 h-4 ${r==="he"?"ml-2":"mr-2"}`}),a.report_options]}),e.jsx("p",{className:`text-sm text-gray-600 ${r==="he"?"text-right":"text-left"}`,children:m==="inventory"?a.inventory_report_description||"This report generates an Excel file with current inventory details. You can sort the data by various fields and choose to include borrowed items.":m==="loans"?a.loans_report_description||"This report generates an Excel file of active loans. You can choose to include historical loans and sort by various fields.":a.qr_codes_description||"This report generates a printable PDF of QR codes arranged in a grid with cutting guides."}),m==="qr_codes"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{children:a.select_all||"Select All"}),e.jsxs("label",{className:"switch",children:[e.jsx("input",{type:"checkbox",checked:P,onChange:E}),e.jsx("span",{className:"slider"})]})]}),e.jsxs("table",{className:"qr-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"40px"}}),e.jsxs("th",{onClick:()=>G("qr_code"),children:[a.qr_code||"QR Code"," ",c==="qr_code"&&(w?"▲":"▼")]}),e.jsxs("th",{onClick:()=>G("title"),children:[a.book_title||"Title"," ",c==="title"&&(w?"▲":"▼")]})]})}),e.jsxs("tbody",{children:[B.map((d,T)=>e.jsxs("tr",{onClick:()=>A(T),className:"cursor-pointer",children:[e.jsx("td",{children:e.jsx("input",{type:"checkbox",checked:d.selected,onChange:$=>{$.stopPropagation(),A(T)}})}),e.jsx("td",{children:d.qr_code}),e.jsx("td",{children:d.title||"(No Title)"})]},d.qr_code)),B.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"text-sm text-gray-500",children:a.no_qr_codes||"No QR codes found."})})]})]})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[m==="loans"&&e.jsx("div",{className:"flex items-center col-span-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>p(!u),className:`relative inline-flex h-6 w-10 items-center rounded-full transition-colors duration-200 ease-in-out ${u?"bg-teal-600":"bg-gray-200"}`,children:e.jsx("span",{className:`absolute ${r==="he"?"right-1":"left-1"} top-1 h-4 w-4 transform rounded-full bg-white transition-transform duration-200 ease-in-out ${u?r==="he"?"-translate-x-5":"translate-x-5":"translate-x-0"}`})}),e.jsx("span",{className:"text-sm text-gray-600",children:a.include_history})]})}),m==="inventory"&&e.jsx("div",{className:"flex items-center col-span-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>f(!g),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors duration-200 ease-in-out ${g?"bg-teal-600":"bg-gray-200"}`,children:e.jsx("span",{className:`absolute ${r==="he"?"right-1":"left-1"} top-1 h-4 w-4 transform rounded-full bg-white transition-transform duration-200 ease-in-out ${g?r==="he"?"-translate-x-5":"translate-x-4":"translate-x-0"}`})}),e.jsx("span",{className:"text-sm text-gray-600",children:a.include_borrowed})]})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{children:a.sort_by}),e.jsxs("select",{value:C,onChange:d=>b(d.target.value),className:"border rounded-md",children:[e.jsx("option",{value:"",children:a.select_field}),F[m].map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{children:a.order}),e.jsxs("select",{value:v,onChange:d=>M(d.target.value),className:"border rounded-md",children:[e.jsx("option",{value:"asc",children:a.ascending}),e.jsx("option",{value:"desc",children:a.descending})]})]})]}),e.jsxs("button",{onClick:U,disabled:R(),className:`w-full p-2 bg-teal-500 text-white rounded-md flex items-center justify-center ${r==="he"?"flex-row-reverse":""}`,children:[a.generate_report_button," ",e.jsx(Ue,{className:`w-4 h-4 ${r==="he"?"ml-2":"mr-2"}`})]})]})})]})]})})},qr="/icm_lib/assets/banner_nobg-ldt_Oxdo.png",Ar=({onLogout:r,onNavigate:s,activeTab:a})=>{const[u,p]=l.useState(!1),[g,f]=l.useState(!1),[v,M]=l.useState(!1),{language:C,toggleLanguage:b,direction:m}=J(),x=Z(C),B={inventory:"#14b8a6",loans:"#ef4444",members:"#FDB813",reports:"#a855f7"};l.useEffect(()=>{const y=async()=>{const q=await Re();f(q);const w=await lr();M(w)};y();const c=setInterval(y,6e4);return()=>clearInterval(c)},[]);const Q=()=>p(!u),P=l.useCallback(()=>{console.log("Language toggle clicked, current language:",C),b(),setTimeout(()=>p(!1),100)},[C,b]),S=C==="he"?"left-4":"right-4",j=[{value:"inventory",label:x.books,icon:e.jsx(fe,{size:16,className:m==="rtl"?"ml-1":"mr-1"})},{value:"loans",label:x.loans,icon:e.jsx(se,{size:16,className:m==="rtl"?"ml-1":"mr-1"})},{value:"members",label:x.members,icon:e.jsx(ye,{size:16,className:m==="rtl"?"ml-1":"mr-1"})},{value:"reports",label:x.reports,icon:e.jsx(we,{size:16,className:m==="rtl"?"ml-1":"mr-1"})}];return e.jsxs("div",{style:{position:"fixed",top:0,left:0,width:"100%",zIndex:1e3},children:[e.jsx("button",{onClick:Q,className:`fixed top-4 ${S} w-10 h-10 flex items-center justify-center bg-white/90 rounded-full shadow-md hover:bg-gray-100 transition-colors`,"aria-label":u?"Close menu":"Open menu",children:u?e.jsx(Ye,{size:20}):e.jsx(We,{size:20})}),u&&e.jsx("div",{className:"fixed inset-0 z-40 bg-black/10",onClick:()=>p(!1),"aria-hidden":"true"}),u&&e.jsx("div",{className:`fixed top-16 ${S} z-50 bg-white rounded-lg shadow-lg p-2 border border-gray-200 ${m==="rtl"?"rtl text-right":"ltr text-left"}`,children:e.jsxs("ul",{className:"space-y-1 w-48",children:[e.jsx("li",{className:"px-3 py-2 text-sm font-medium text-gray-700 border-b border-gray-200",children:x.system_status||"System Status"}),e.jsxs("li",{className:"px-3 py-2 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:x.backend_status}),e.jsxs("a",{href:"https://status.koyeb.com/",target:"_blank",rel:"noopener noreferrer",className:`inline-flex items-center ${g?"text-green-500":"text-red-500"} hover:underline`,children:[e.jsx(Se,{size:16,className:m==="rtl"?"ml-1":"mr-1"}),e.jsx("span",{className:"text-xs font-medium",children:g?x.connected:x.disconnected})]})]}),e.jsxs("li",{className:"px-3 py-2 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:x.database_status}),e.jsxs("a",{href:"https://neonstatus.com/aws-europe-frankfurt",target:"_blank",rel:"noopener noreferrer",className:`inline-flex items-center ${v?"text-green-500":"text-red-500"} hover:underline`,children:[e.jsx(Se,{size:16,className:m==="rtl"?"ml-1":"mr-1"}),e.jsx("span",{className:"text-xs font-medium",children:v?x.connected:x.disconnected})]})]}),e.jsx("li",{className:"border-t border-gray-200 mt-1 pt-1",children:e.jsx("div",{className:"px-3 py-2 text-sm font-medium text-gray-700",children:x.navigate||"Navigate"})}),j.map(y=>{const c=a===y.value,q=c?B[y.value]:"#666";return e.jsx("li",{className:"px-3 py-1",children:e.jsxs("button",{onClick:()=>{s(y.value),p(!1)},className:`w-full text-sm rounded-md hover:bg-gray-100 flex items-center ${c?"font-medium":""}`,children:[Te.cloneElement(y.icon,{style:{color:q},className:m==="rtl"?"ml-1":"mr-1"}),e.jsx("span",{children:y.label})]})},y.value)}),e.jsx("li",{className:"border-t border-gray-200 mt-1 pt-1",children:e.jsxs("button",{id:"language-toggle-btn",onClick:P,className:"w-full px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-md flex items-center",type:"button",children:[e.jsx(Ge,{size:16,className:m==="rtl"?"ml-2":"mr-2"}),C==="en"?"עברית":"English"]})}),e.jsx("li",{children:e.jsxs("button",{onClick:()=>{r(),p(!1)},className:"w-full px-3 py-2 text-sm text-red-600 hover:bg-red-50 rounded-md flex items-center",children:[e.jsx(Ke,{size:16,className:m==="rtl"?"ml-2":"mr-2"}),x.logout||"Logout"]})})]})})]})};function $r(){const[r,s]=l.useState(!1),a=()=>{s(!0)},u=()=>{s(!1)};return e.jsx(tr,{children:r?e.jsx(Dr,{onLogout:u}):e.jsx(_r,{onLogin:a})})}function Dr({onLogout:r}){const{language:s}=J(),a=Z(s),u=s==="he",[p,g]=l.useState("inventory"),f=u?[{value:"reports",icon:e.jsx(we,{className:"w-4 h-4 mr-2"}),label:a.reports},{value:"members",icon:e.jsx(ye,{className:"w-4 h-4 mr-2"}),label:a.members},{value:"loans",icon:e.jsx(se,{className:"w-4 h-4 mr-2"}),label:a.loans},{value:"inventory",icon:e.jsx(fe,{className:"w-4 h-4 mr-2"}),label:a.books}]:[{value:"inventory",icon:e.jsx(fe,{className:"w-4 h-4 mr-2"}),label:a.books},{value:"loans",icon:e.jsx(se,{className:"w-4 h-4 mr-2"}),label:a.loans},{value:"members",icon:e.jsx(ye,{className:"w-4 h-4 mr-2"}),label:a.members},{value:"reports",icon:e.jsx(we,{className:"w-4 h-4 mr-2"}),label:a.reports}];return e.jsxs("div",{className:`app-container min-h-screen bg-blend-screen max-w-md mx-auto ${u?"rtl":"ltr"}`,children:[e.jsx(Ar,{onLogout:r,onNavigate:g,activeTab:p}),e.jsx("header",{className:"bg-white drop-shadow-2xl rounded-full",children:e.jsxs("div",{className:"banner-container",children:[e.jsx("img",{src:qr,alt:"ICM Library Logo",className:"banner-logo"}),e.jsx("div",{className:"banner-text",children:e.jsx("p",{className:"text-sm text-gray-600",children:a.app_title})})]})}),e.jsx("div",{className:"max-w-md mx-auto",children:e.jsxs(Xe,{value:p,onValueChange:g,className:"tabs-content",children:[e.jsx(Je,{className:"tabs-list w-full shadow-md rounded-lg grid grid-cols-4",children:f.map(v=>e.jsxs(Ze,{value:v.value,className:`tab-item 
                                    flex items-center justify-center 
                                    text-gray-800 py-2 rounded-t-lg hover:bg-gray-100 
                                    ${v.value==="inventory"&&"data-[state=active]:bg-teal-500 data-[state=active]:!text-white"}
                                    ${v.value==="loans"&&"data-[state=active]:bg-red-500 data-[state=active]:!text-white"}
                                    ${v.value==="members"&&"data-[state=active]:bg-[#FDB813] data-[state=active]:!text-white"}
                                    ${v.value==="reports"&&"data-[state=active]:bg-purple-500 data-[state=active]:!text-white"}`,children:[v.icon,v.label]},v.value))}),e.jsx("div",{style:{height:"15px"}}),e.jsx(de,{value:"inventory",children:e.jsx(xr,{})}),e.jsx(de,{value:"loans",children:e.jsx(Sr,{})}),e.jsx(de,{value:"members",children:e.jsx(fr,{})}),e.jsx(de,{value:"reports",children:e.jsx(Rr,{})})]})})]})}function Tr(){"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/icm_lib/sw.js").then(r=>{console.log("SW registered: ",r),setInterval(()=>{r.update()},6e4)}).catch(r=>{console.log("SW registration failed: ",r)})})}Me(document.getElementById("root")).render(e.jsx(l.StrictMode,{children:e.jsx($r,{})}));Tr();
