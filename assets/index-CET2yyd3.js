import{r as a,j as e}from"./react-Dl5khTFu.js";import{c as Ee}from"./react-dom-CaK7Gm4w.js";import{a as T}from"./axios-upsvKRUO.js";import{C as ye,a as fe,S as je,T as Ae,Q as xe,M as Re,b as $e,F as qe,c as Me,D as Pe,B as De,U as Ie,d as Te}from"./lucide-react-FyWqbqIQ.js";import{S as we}from"./react-select-DNjq-Jfl.js";import{H as Fe}from"./html5-qrcode-CAPQZwmQ.js";import{T as He,a as Qe,b as ie,c as de}from"./@radix-ui-FaNOjPFF.js";import"./hoist-non-react-statics-DUIF_pJT.js";import"./react-is-8JwjhRSi.js";import"./scheduler-CylivXx-.js";import"./@babel-DeGXz7kM.js";import"./@emotion-C1jRIs2C.js";import"./stylis-YPZU7XtI.js";import"./@floating-ui-DZ2V_EUC.js";import"./use-isomorphic-layout-effect-Do5Xa1W_.js";import"./memoize-one-DxrTgWdQ.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const b of document.querySelectorAll('link[rel="modulepreload"]'))d(b);new MutationObserver(b=>{for(const p of b)if(p.type==="childList")for(const y of p.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&d(y)}).observe(document,{childList:!0,subtree:!0});function n(b){const p={};return b.integrity&&(p.integrity=b.integrity),b.referrerPolicy&&(p.referrerPolicy=b.referrerPolicy),b.crossOrigin==="use-credentials"?p.credentials="include":b.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function d(b){if(b.ep)return;b.ep=!0;const p=n(b);fetch(b.href,p)}})();const Ue="/icm_lib/assets/img-Dm6ee46N.png",Oe="/icm_lib/assets/bookshelf-8M74edYe.png",q="https://religious-cherianne-dbprops-ef8ee171.koyeb.app",Ne=a.createContext(),ze=({children:r})=>{const[s,n]=a.useState("he"),d=p=>p==="he"?"rtl":"ltr",b=()=>{n(p=>p==="en"?"he":"en")};return e.jsx(Ne.Provider,{value:{language:s,setLanguage:n,toggleLanguage:b,direction:d(s)},children:r})},G=()=>a.useContext(Ne),Ke={by:"by",app_title:"Israeli Community of Madrid Library",title:"Book Title",author:"Author",description:"Description",year_of_publication:"Year of Publication",cover_type:"Cover Type",pages:"Pages",borrowing_child:"Borrowing Child's Name",borrowed_by:"Borrowed By",borrower:"Borrower",borrow:"Borrow Book",delivery_status:"Delivery Status",delivering_parent:"Delivering Parent",recommended_age:"Recommended Age",borrow_date:"Borrow Date",return_date:"Return Date",NotReturned:"Not Returned",add_book_label:"Add New Book",books:"Books",members:"Members",loans:"Loans",ShowAllLoans:"Show History",Hide_Details:"Hide Details",More_Details:"More Details",loan_status:"Availability",sort_by:"Order",ascending:"Ascending",descending:"Descending",Hide_Add_Book:"Hide Add Book",Add_Book:"Add Book",return:"Return Book",Select_Book:"Select Book",Select_Book_State:"Select Book State",ScanQR:"Scan QR Code",download_qr_code:"Download QR Code",SendReminders:"Send Reminders",last_reminder:"last reminder at",no_reminder_sent:"No Reminders Sent",sending_reminders:"Sending...",send_x_reminders:"Send {count} Reminders",error_generating_report:"Failed to generate report. Please try again.",reports:"Reports",generate_report_button:"Generate report",select_borrower:"Select Borrower",add_member_button:"Add Member",edit_member:"Edit Member",delete_member:"Delete Member",close_add_member_button:"Close Add Member",add_member_form_title:"Add New Member",search_placeholder:"Search members by name",members_list_title:"Library Members",no_members_found:"No members found",select_all:"Select All",parent_name_placeholder:"Parent's Name",kid_name_placeholder:"Kid's Name",parent_name_borrower:"Parent",kid_name_borrower:"Kid",email_placeholder:"Email Address",error_parent_name_required:"Parent's name is required.",error_kid_name_required:"Kid's name is required.",error_email_required:"Email address is required.",error_email_invalid:"Invalid email address.",email_missing_warning:"No email provided - notifications will not be sent to this member",confirm_delete_member:"Are you sure you want to delete this member?",no_email_provided:"No email provided",success_member_added:"Member added successfully!",success_member_updated:"Member updates successfully!",success_member_deleted:"Member deleted successfully!",parent_name_label:"Parent Name",kid_name_label:"Child Name",email_label:"Email",inventory_list_title:"Library Inventory",add_book_button:"Add Book",close_add_book_button:"Close Add Book",search_books_placeholder:"Search books by title",no_books_found:"No books found",placeholder_book_title:"Enter Book Title",placeholder_book_author:"Enter Author Name",placeholder_book_description:"Enter Description",placeholder_book_year:"Enter Year of Publication",placeholder_book_pages:"Enter Number of Pages",placeholder_book_recommended_age:"Enter Recommended Age",select_condition:"Select Condition",select_loan_status:"Select loan status",select_parent:"Select Parent",select_cover_type:"format",soft_cover:"Soft Cover",hard_cover:"Hard Cover",rigid_pages:"Rigid Pages",battery_book:"Book with Battery",new:"Like New",good:"Excellent - No noticeable wear",worn:"Good - Minor wear",available:"Available",borrowed:"Borrowed",error_book_title_required:"Book title is required.",error_book_author_required:"Author name is required.",error_book_description_required:"Description is required.",error_book_year_required:"Year of publication is required.",error_book_pages_required:"Number of pages is required.",inventory_report:"Inventory Report",loans_report:"Loans Report",select_report_type:"Select Report Type",report_options:"Report Options",select_field:"Select Field",book_title:"Book Title",id:"ID",order:"Order",include_history:"Include Historical Loans",include_borrowed:"Include Currently Borrowed Books",update_book_button:"Update book information",edit_book:"Edit book information",login_title:"Library Login",username:"Username",password:"Password",username_placeholder:"Enter username",password_placeholder:"Enter password",login_button:"Login",logging_in:"Logging in...",invalid_credentials:"Invalid username or password."},Ye={by:"על ידי",app_title:"ספריית הקהילה הישראלית במדריד",title:"שם הספר",author:"שם המחבר",description:"תיאור",year_of_publication:"שנת הוצאה",cover_type:"סוג כריכה",pages:"עמודים",borrowing_child:"שם הילד המשאיל",borrowed_by:"הושאל על ידי",borrower:"המשאיל",borrow:"השאל ספר",delivery_status:"מצב מסירה",delivering_parent:"שם ההורה המוסר",recommended_age:"גיל מומלץ",borrow_date:"תאריך השאלה",return_date:"תאריך החזרה",NotReturned:"לא הוחזר",add_book_label:"הוסף ספר חדש",books:"ספרים",members:"חברים",loans:"השאלות",ShowAllLoans:"הצג היסטוריה",Hide_Details:"הסתר פרטים",More_Details:"עוד פרטים",loan_status:"זמינות",sort_by:"סדר",ascending:"עולה",descending:"יורד",Hide_Add_Book:"הסתר הוספת ספר",Add_Book:"הוסף ספר",return:"החזר ספר",Select_Book:"בחר ספר",Select_Book_State:"מצב הספר",ScanQR:"סרוק ברקוד",download_qr_code:"הורד ברקוד",SendReminders:"שלח תזכורת",last_reminder:"תזכורת אחרונה ב",no_reminder_sent:"לא נשלחה תזכורת",sending_reminders:"שולח...",send_x_reminders:"שלח {count} תזכורות",error_generating_report:"הפקת הדוח נכשלה, נסה שנית בבקשה.",reports:"דוחות",generate_report_button:"הפק דוח",select_borrower:"בחר משאיל",add_member_button:"הוסף חבר",edit_member:"ערוך",delete_member:"מחק חבר",close_add_member_button:"סגור הוספת חבר",add_member_form_title:"הוספת חבר חדש",search_placeholder:"חפש חברים לפי שם",members_list_title:"חברי הספרייה",no_members_found:"לא נמצאו חברים",select_all:"בחר הכל",parent_name_placeholder:"שם ההורה המשאיל",kid_name_placeholder:"שם הילד המשאיל",parent_name_borrower:"ההורה",kid_name_borrower:"הילד",email_placeholder:"כתובת אימייל",error_parent_name_required:"נדרש שם הורה.",error_kid_name_required:"נדרש שם ילד.",error_email_required:"נדרשת כתובת אימייל.",error_email_invalid:"כתובת אימייל לא תקינה.",email_missing_warning:"לא סופק אימייל - לא יישלחו התראות לחבר זה",no_email_provided:"לא סופק אימייל",success_member_added:"החבר נוסף בהצלחה!",success_member_updated:"החבר עודכן בהצלחה!",success_member_deleted:"חבר נמחק בהצלחה!",parent_name_label:"שם ההורה",kid_name_label:"שם הילד",email_label:"אימייל",inventory_list_title:"מלאי הספרייה",add_book_button:"הוסף ספר",close_add_book_button:"סגור הוספת ספר",search_books_placeholder:"חפש ספרים לפי שם",no_books_found:"לא נמצאו ספרים",placeholder_book_title:"הכנס שם הספר",placeholder_book_author:"הכנס שם המחבר",placeholder_book_description:"הכנס תיאור",placeholder_book_year:"הכנס שנת הוצאה",placeholder_book_pages:"הכנס מספר עמודים",placeholder_book_recommended_age:"הכנס גיל מומלץ",select_condition:"מצב מסירה",select_loan_status:"זמינות",select_parent:"שם ההורה",select_cover_type:"פורמט",soft_cover:"כריכה רכה",hard_cover:"כריכה קשה",rigid_pages:"עמודים קשיחים",battery_book:"ספר עם בטריה",new:"כמו חדש",good:"מצויין - בלאי בלתי מורגש",worn:"טוב - בלאי קל",available:"זמין",borrowed:"מושאל",error_book_title_required:"נדרש שם ספר.",error_book_author_required:"נדרש שם מחבר.",error_book_description_required:"נדרש תיאור.",error_book_year_required:"נדרשת שנת הוצאה.",error_book_pages_required:"נדרש מספר עמודים.",confirm_delete_member:"האם אתה בטוח שברצונך למחוק חבר זה?",inventory_report:"דוח מלאי",loans_report:"דוח השאלות",select_report_type:"בחר סוג דוח",report_options:"אפשרויות דוח",select_field:"בחר שדה",book_title:"כותרת הספר",id:"מזהה",order:"סדר",include_history:"כלול היסטורית השאלות",include_borrowed:"כלול ספרים מושאלים",update_book_button:"עדכון ספר",edit_book:"ערוך ספר",login_title:"כניסה לספרייה",username:"שם משתמש",password:"סיסמה",username_placeholder:"הכנס שם משתמש",password_placeholder:"הכנס סיסמה",login_button:"כניסה",logging_in:"מתחבר...",invalid_credentials:"שם משתמש או סיסמה לא נכונים."},V=r=>r==="he"?Ye:Ke,Ge=(r,s)=>({"כריכה רכה":s.soft_cover,"כריכה קשה":s.hard_cover,"עמודים קשיחים":s.rigid_pages,"ספר עם בטריה":s.battery_book})[r]||"N/A",Ve=(r,s)=>({"כמו חדש":s.new,"מצויין - בלאי בלתי מורגש":s.good,"טוב - בלאי קל":s.worn})[r]||"N/A",We=({onLogin:r})=>{const[s,n]=a.useState(""),[d,b]=a.useState(""),[p,y]=a.useState(""),[v,N]=a.useState(!1),{language:j,toggleLanguage:c,direction:_}=G(),w=V(j),k=async S=>{S.preventDefault(),N(!0);try{const g=await T.post(`${q}/api/login`,{username:s,password:d});g.status===200&&(localStorage.setItem("authToken",g.data.token),r())}catch{y(w.invalid_credentials)}N(!1)};return e.jsxs("div",{className:"min-h-screen relative flex items-center justify-center",children:[e.jsx("button",{className:"w-12 h-12 flex items-center justify-center rounded-full border border-teal-500 bg-white text-teal-500 shadow-md absolute top-2 left-2",onClick:c,children:j==="en"?"HE":"EN"}),e.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat opacity-20",style:{backgroundImage:`url(${Oe})`,backgroundSize:"cover",backgroundPosition:"center"}}),e.jsxs("div",{className:"relative z-10 w-full max-w-[320px] sm:max-w-[380px] mx-4 rounded-3xl overflow-hidden shadow-xl",children:[e.jsx("div",{className:"bg-white rounded-3xl p-4",children:e.jsx("img",{src:Ue,alt:"ICM Library Logo",className:"h-12 sm:h-16 w-auto mx-auto"})}),e.jsx("div",{dir:_,children:e.jsxs("form",{onSubmit:k,className:"backdrop-blur-sm bg-white/20 p-6 sm:p-8 rounded-3xl",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold mb-4 sm:mb-6 text-center text-gray-800",children:w.login_title}),p&&e.jsx("div",{className:"text-red-500 text-sm mb-4 bg-red-50 p-2 rounded",children:p}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-medium mb-2",children:w.username}),e.jsx("input",{type:"text",className:`w-full p-2.5 sm:p-3 border border-gray-200 rounded-md\r
                                             bg-white/50 backdrop-blur-sm focus:ring-2\r
                                             focus:ring-blue-500 focus:border-transparent`,value:s,onChange:S=>n(S.target.value),placeholder:w.username_placeholder})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-medium mb-2",children:w.password}),e.jsx("input",{type:"password",className:`w-full p-2.5 sm:p-3 border border-gray-200 rounded-md\r
                                             bg-white/50 backdrop-blur-sm focus:ring-2\r
                                             focus:ring-blue-500 focus:border-transparent`,value:d,onChange:S=>b(S.target.value),placeholder:w.password_placeholder})]}),e.jsx("button",{type:"submit",className:`w-full py-2.5 sm:py-3 rounded-md transition duration-200 
                                         ${v?"bg-gray-400 cursor-not-allowed":"bg-blue-500 hover:bg-blue-600 active:bg-blue-700"} text-white font-semibold shadow-md`,disabled:v,children:v?w.logging_in:w.login_button})]})]})})]})]})},M=T.create({baseURL:q});M.interceptors.request.use(r=>{const s=localStorage.getItem("authToken");return console.log("Token in localStorage:",s),s&&(r.headers.Authorization=s),r},r=>Promise.reject(r));M.interceptors.response.use(r=>r,r=>(r.response&&r.response.status===403&&(localStorage.removeItem("authToken"),alert("Session expired. Please log in again."),window.location.reload()),Promise.reject(r)));const Je=async r=>{try{return(await M.post("/api/members",r)).data}catch{throw new Error("Failed to add member.")}},ke=async()=>{try{return(await M.get("/api/members")).data}catch(r){throw console.error("Error fetching members:",r),r}},Xe=async(r,s)=>{try{return(await M.put(`/api/members/${r}`,s)).data}catch(n){throw console.error("Error updating member:",n),n}},Ze=async r=>{try{return(await M.delete(`/api/members/${r}`)).data}catch(s){throw console.error("Error deleting member:",s),s}},er=async(r="desc")=>{try{return(await T.get(`${q}/api/books?order_by=${r}`)).data}catch(s){throw console.error("Error fetching books:",s),s}},rr=async r=>{try{return(await M.post("/api/books",r,{headers:{"Content-Type":"application/json"}})).data}catch(s){throw console.error("Error adding book:",s),new Error("Failed to add book.")}},tr=async r=>{try{const s=await T.get(`${q}/api/qr_codes/${r}`,{responseType:"blob"}),n=window.URL.createObjectURL(new Blob([s.data])),d=document.createElement("a");d.href=n,d.setAttribute("download",r),document.body.appendChild(d),d.click(),d.remove()}catch(s){throw console.error("Error downloading QR code:",s),s}},or=async(r,s)=>{try{return(await M.put(`${q}/api/books/${r}`,s)).data}catch(n){throw console.error("Error updating book:",n),n}},sr=()=>{const[r,s]=a.useState([]),[n,d]=a.useState("desc"),[b,p]=a.useState(""),[y,v]=a.useState(""),[N,j]=a.useState(""),[c,_]=a.useState(""),[w,k]=a.useState(""),[S,g]=a.useState(""),[E,C]=a.useState(""),[K,f]=a.useState(""),[P]=a.useState("available"),[A,R]=a.useState(""),[W,J]=a.useState([]),[F,U]=a.useState(!1),[D,u]=a.useState(""),[$,Q]=a.useState({}),{language:O,toggleLanguage:ee,direction:re}=G(),i=V(O),[X,ce]=a.useState(null),[m,H]=a.useState(""),te=[{value:"כריכה רכה",label:i.soft_cover},{value:"כריכה קשה",label:i.hard_cover},{value:"עמודים קשיחים",label:i.rigid_pages},{value:"ספר עם בטריה",label:i.battery_book}],oe=[{value:"כמו חדש",label:i.new},{value:"מצויין - בלאי בלתי מורגש",label:i.good},{value:"טוב - בלאי קל",label:i.worn}];a.useEffect(()=>{se(),ue()},[n]),a.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[]);const se=async()=>{try{const o=await er(n);Array.isArray(o)?s(o):(console.error("Unexpected response format:",o),s([]))}catch(o){console.error("Failed to load books:",o),s([])}},ue=async()=>{try{const o=await ke();J(o)}catch(o){console.error("Error fetching members:",o)}},me=async o=>{o.preventDefault();try{const I={title:b,author:y,description:N,year_of_publication:c,pages:w,cover_type:S,book_condition:E,recommended_age:K,loan_status:P,delivering_parent:A};X?await or(X,I):await rr(I),ce(null),H(""),p(""),v(""),j(""),_(""),k(""),g(te[0].value),C(oe[0].value),R(""),U(!1),await se()}catch(I){console.error("Error saving book:",I)}},he=o=>{U(!0),ce(o.id),H(o.qr_code),p(o.title),v(o.author||""),j(o.description||""),_(o.year_of_publication||""),k(o.pages||""),g(o.cover_type||""),C(o.book_condition||""),f(o.recommended_age||""),R(o.delivering_parent||"")},be=o=>{Q(I=>({...I,[o]:!I[o]}))},ae=o=>{tr(o).then(()=>console.log("QR Code downloaded successfully")).catch(I=>console.error("Failed to download QR Code:",I))};return e.jsxs("div",{className:"w-full max-w-md mx-auto",children:[e.jsx("button",{className:"w-12 h-12 flex items-center justify-center rounded-full border border-teal-500 bg-white/50 text-teal-500 shadow-md absolute top-2 left-2",onClick:ee,children:O==="en"?"HE":"EN"}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("input",{id:"search_by_name",type:"text",placeholder:i.search_books_placeholder,value:D,onChange:o=>u(o.target.value),className:"flex-1 mr-4 border border-gray-300 rounded-md py-1.5 px-4"}),e.jsx("div",{className:"sorting-container",children:e.jsx("button",{onClick:()=>d(n==="desc"?"asc":"desc"),className:"p-2 border rounded bg-gray-100 hover:bg-gray-200 transition","aria-label":i.sort_by,children:n==="desc"?e.jsx(ye,{size:20}):e.jsx(fe,{size:20})})})]}),e.jsx("button",{onClick:()=>U(!F),className:"w-full bg-blue-500 text-white font-semibold py-2 rounded-md hover:bg-blue-600 transition mb-4",children:F?`- ${i.close_add_book_button}`:`+ ${i.add_book_button}`}),F&&e.jsxs("form",{onSubmit:me,className:"mb-4",children:[e.jsx("input",{type:"text",value:b,onChange:o=>p(o.target.value),placeholder:i.placeholder_book_title,className:"input mb-2 w-full border border-gray-300 rounded-md py-2 px-4"}),e.jsx("input",{type:"text",value:y,onChange:o=>v(o.target.value),placeholder:i.placeholder_book_author,className:"input mb-2 w-full border border-gray-300 rounded-md py-2 px-4"}),e.jsx("textarea",{value:N,onChange:o=>j(o.target.value),onInput:o=>{o.target.style.height="auto",o.target.style.height=`${o.target.scrollHeight}px`},placeholder:i.placeholder_book_description,className:"input mb-2 w-full border border-gray-300 rounded-md py-2 px-4"}),e.jsx("input",{type:"number",value:c,onChange:o=>_(o.target.value),placeholder:i.placeholder_book_year,className:"input mb-2 w-full border border-gray-300 rounded-md py-2 px-4"}),e.jsxs("select",{value:S,onChange:o=>g(o.target.value),className:"input mb-2 w-full border border-gray-300 rounded-md py-2 px-4",children:[e.jsx("option",{value:"",children:i.select_cover_type}),te.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))]}),e.jsx("input",{type:"number",value:w,onChange:o=>k(o.target.value),placeholder:i.placeholder_book_pages,className:"input mb-2 w-full border border-gray-300 rounded-md py-2 px-4"}),e.jsx("input",{type:"number",value:K,onChange:o=>f(o.target.value),placeholder:i.placeholder_book_recommended_age,className:"input mb-2 w-full border border-gray-300 rounded-md py-2 px-4"}),e.jsxs("select",{value:E,onChange:o=>C(o.target.value),className:"input mb-2 w-full border border-gray-300 rounded-md py-2 px-4",children:[e.jsx("option",{value:"",children:i.select_condition}),oe.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))]}),e.jsxs("select",{value:A,onChange:o=>R(o.target.value),className:"input mb-2 w-full border border-gray-300 rounded-md py-2 px-4",children:[e.jsx("option",{value:"",children:i.select_parent}),W.map(o=>e.jsx("option",{value:o.parent_name,children:o.parent_name},o.id))]}),e.jsx("button",{type:"submit",className:"w-full bg-green-500 text-white font-semibold py-2 rounded-md hover:bg-green-600 transition",children:X?i.update_book_button:i.add_book_button})]}),e.jsx("div",{dir:re,children:e.jsx("div",{className:"overflow-y-auto max-h-screen border-t pt-4",children:r.filter(o=>o.title.toLowerCase().includes(D.toLowerCase())||o.author.toLowerCase().includes(D.toLowerCase())).map(o=>e.jsxs("div",{className:"bg-gray-50 shadow-sm rounded-lg p-4 mb-2 relative",children:[e.jsxs("div",{className:"mb-12",children:[e.jsx("h2",{className:"font-bold text-gray-800",children:o.title}),e.jsx("p",{className:"text-sm text-gray-500",children:o.author}),e.jsxs("p",{className:"text-sm mb-4",children:[e.jsx("span",{className:o.loan_status==="available"?"text-green-500":"text-red-500",children:o.loan_status==="borrowed"?i.borrowed:i.available}),o.loan_status==="borrowed"&&e.jsxs("span",{children:[" ",i.by," ",o.borrowing_child]})]}),e.jsx("button",{onClick:()=>ae(`${o.qr_code}.png`),className:"text-blue-600 text-sm px-3 py-1 rounded-md border border-blue-600 hover:bg-blue-50 transition-colors duration-200",children:i.download_qr_code})]}),e.jsxs("div",{className:"absolute bottom-4 inset-x-4 flex justify-between items-center",children:[e.jsx("button",{onClick:()=>he(o),className:"p-2 text-gray-600 hover:text-emerald-600 transition-colors duration-200","aria-label":i.edit_book,children:e.jsx(je,{size:20})}),e.jsx("button",{onClick:()=>be(o.qr_code),className:"flex items-center gap-1 text-gray-600 hover:text-indigo-600 transition-colors duration-200",children:$[o.qr_code]?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm",children:i.Hide_Details}),e.jsx(fe,{size:20})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm",children:i.More_Details}),e.jsx(ye,{size:20})]})}),e.jsx("div",{className:"w-8","aria-hidden":"true"})]}),$[o.qr_code]&&e.jsxs("div",{className:"mt-8 mb-8 text-gray-600 bg-white p-4 rounded-md border border-gray-100",children:[e.jsxs("p",{children:[e.jsxs("strong",{children:[i.description,":"]})," ",o.description||"N/A"]}),e.jsxs("p",{children:[e.jsxs("strong",{children:[i.year_of_publication,":"]})," ",o.year_of_publication||"N/A"]}),e.jsxs("p",{children:[e.jsxs("strong",{children:[i.cover_type,":"]})," ",Ge(o.cover_type,i)]}),e.jsxs("p",{children:[e.jsxs("strong",{children:[i.pages,":"]})," ",o.pages||"N/A"]}),e.jsxs("p",{children:[e.jsxs("strong",{children:[i.recommended_age,":"]})," ",o.recommended_age||"N/A"]}),e.jsxs("p",{children:[e.jsxs("strong",{children:[i.select_condition,":"]})," ",Ve(o.book_condition,i)]}),e.jsxs("p",{children:[e.jsxs("strong",{children:[i.delivering_parent,":"]})," ",o.delivering_parent||"N/A"]})]})]},o.qr_code))})})]})};function ar(){const[r,s]=a.useState([]),[n,d]=a.useState(""),[b,p]=a.useState(""),[y,v]=a.useState(""),[N,j]=a.useState(!1),[c,_]=a.useState(""),[w,k]=a.useState({}),[S,g]=a.useState(""),{language:E,toggleLanguage:C,direction:K}=G(),f=V(E),[P,A]=a.useState(null);a.useState({});const R=()=>{const u={};return n.trim()||(u.parentName=f.error_parent_name_required),b.trim()||(u.kidName=f.error_kid_name_required),y.trim()&&!/\S+@\S+\.\S+/.test(y)&&(u.email=f.error_email_invalid),k(u),Object.keys(u).length===0},W=async u=>{if(u.preventDefault(),!!R()){y.trim()||alert(f.email_missing_warning);try{const $={parent_name:n,kid_name:b,email:y};P?await Xe(P,$):await Je($),A(null),d(""),p(""),v(""),k({}),g(P?f.success_member_updated:f.success_member_added),await U()}catch($){console.error("Error saving member:",$),g("")}}},J=async u=>{if(window.confirm(f.confirm_delete_member))try{await Ze(u),g(f.success_member_deleted),await U()}catch($){console.error("Error deleting member:",$),alert("Cannot delete member: they have open loans.")}},F=u=>{A(u.id),d(u.parent_name),p(u.kid_name),v(u.email),j(!0)},U=async()=>{try{const u=await ke();Array.isArray(u)?s(u):(console.error("Unexpected response format:",u),s([]))}catch(u){console.error("Failed to load members:",u),s([])}};a.useEffect(()=>{U()},[]);const D=Array.isArray(r)?r.filter(u=>u.parent_name.toLowerCase().includes(c.toLowerCase())||u.kid_name.toLowerCase().includes(c.toLowerCase())):[];return e.jsxs("div",{className:"w-full max-w-md mx-auto",children:[e.jsx("button",{className:"w-12 h-12 flex items-center justify-center rounded-full border border-teal-500 bg-white/50 text-teal-500 shadow-md absolute top-2 left-2",onClick:C,children:E==="en"?"HE":"EN"}),e.jsx("button",{onClick:()=>j(!N),className:"w-full bg-blue-500 text-white font-semibold py-2 rounded-md hover:bg-blue-600 transition mb-4",children:N?`- ${f.close_add_member_button}`:`+ ${f.add_member_button}`}),N&&e.jsxs("form",{onSubmit:W,className:"mb-4",children:[e.jsx("input",{type:"text",placeholder:f.parent_name_placeholder,value:n,onChange:u=>d(u.target.value),className:"input mb-2 w-full border border-gray-300 rounded-md py-2 px-4"}),w.parentName&&e.jsx("p",{className:"text-red-500 text-sm",children:w.parentName}),e.jsx("input",{type:"text",placeholder:f.kid_name_placeholder,value:b,onChange:u=>p(u.target.value),className:"input mb-2 w-full border border-gray-300 rounded-md py-2 px-4"}),w.kidName&&e.jsx("p",{className:"text-red-500 text-sm",children:w.kidName}),e.jsx("input",{type:"email",placeholder:f.email_placeholder,value:y,onChange:u=>v(u.target.value),className:"input mb-2 w-full border border-gray-300 rounded-md py-2 px-4"}),w.email&&e.jsx("p",{className:"text-red-500 text-sm",children:w.email}),e.jsx("button",{type:"submit",className:"w-full bg-green-500 text-white font-semibold py-2 rounded-md hover:bg-green-600 transition",children:f.add_member_button}),S&&e.jsx("p",{className:"text-green-500 text-sm mt-2",children:S})]}),e.jsx("input",{type:"text",placeholder:f.search_placeholder,value:c,onChange:u=>_(u.target.value),className:"input w-full border border-gray-300 rounded-md py-2 px-4 mb-4"}),e.jsx("div",{dir:K,children:e.jsx("div",{className:"overflow-y-auto max-h-96 border-t pt-4",children:D.map(u=>e.jsxs("div",{className:"bg-gray-50 shadow-sm rounded-lg p-4 mb-2 relative",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("h2",{className:"font-bold text-gray-800",children:[f.parent_name_label,": ",u.parent_name]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[f.kid_name_label,": ",u.kid_name]}),e.jsxs("p",{className:"text-sm mb-8 text-gray-500",children:[f.email_label,": ",u.email||f.no_email_provided]})]}),e.jsx("div",{className:"absolute bottom-4 inset-x-4 flex justify-between items-center",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>J(u.id),className:"text-gray-600 hover:text-red-600 transition-colors duration-200","aria-label":f.delete_member,children:e.jsx(Ae,{size:20})}),e.jsx("button",{onClick:()=>F(u),className:"p-2 text-gray-600 hover:text-emerald-600 transition-colors duration-200","aria-label":f.edit_member,children:e.jsx(je,{size:20})})]})})]},u.id))})})]})}async function _e(){return await(await T.get(`${q}/api/available_books`)).data}async function ge(){return await(await T.get(`${q}/api/borrowed_books`)).data}async function nr(r){return await(await T.get(`${q}/api/book/${r}`)).data}async function lr(){const r=await M.get("/api/members");return console.log("API Response:",r.data),r.data.members||r.data}const ir=async(r,s,n)=>{try{return(await M.post("/api/book/borrow",{qr_code:r,member_id:s,book_state:n})).data}catch(d){throw console.error("Error borrowing book:",d.response||d),d}},dr=async r=>{try{return(await M.post("/api/book/return",{qr_code:r})).data}catch(s){throw console.error("Error returning book:",s),s}};async function Z(r,s){return(await T.get(`${q}/api/loans/history`,{params:{qr_code:r||"",show_all:s?"true":"false"}})).data}const cr=async(r,s,n,d="en")=>{var b,p;try{return(await M.post("/api/send-reminder",{loan_id:r,subject:s,loan_details:n,language:d})).data}catch(y){return console.error(`Error sending reminder for loan_id ${r}:`,y),{success:!1,error:((p=(b=y.response)==null?void 0:b.data)==null?void 0:p.error)||y.message||"Unknown error"}}},ve=async r=>{try{const s=await T.get(`${q}/api/reminders/last/${r}`),{sent_at:n}=s.data;return{sent_at:n}}catch(s){return console.error(`Error fetching last reminder for loan_id ${r}:`,s),null}},ur=({onScanSuccess:r,onScanError:s,onScanCancel:n})=>{const[d,b]=a.useState(!1),p=async(v,N,j={})=>{try{const c=await v.scanFile(N,!0,j);return console.log("Scan attempt succeeded:",c),c}catch(c){throw console.log("Scan attempt failed:",c),c}},y=async v=>{const N=v.target.files[0];if(!N)return;b(!0);const j=new Fe("qr-reader");try{const c=[{},{bindSearchRegion:!0,maxLength:512,minLength:1},{returnDetailedScanResult:!0,maxLength:512,minLength:1},{experimentalFeatures:{useBarCodeDetectorIfSupported:!1},maxLength:512,minLength:1}];for(let _=0;_<c.length;_++)try{console.log(`Attempting scan with config ${_+1}:`,c[_]);const w=await p(j,N,c[_]);if(w){j.clear(),r(w);return}}catch(w){console.log(`Config ${_+1} failed:`,w)}throw new Error("Unable to scan QR code with any configuration")}catch(c){console.error("Final error:",c),s(c)}finally{try{await j.clear()}catch(c){console.error("Error clearing scanner:",c)}b(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg max-w-md w-full",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Scan QR Code"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{id:"qr-reader",style:{display:"none"}}),e.jsx("div",{className:"flex flex-col items-center",children:e.jsxs("label",{className:"w-full flex flex-col items-center px-4 py-6 bg-coral text-blue rounded-lg shadow-lg tracking-wide uppercase border border-blue cursor-pointer hover:bg-blue hover:text-white",children:[e.jsx("span",{className:"mt-2 text-base leading-normal",children:"Select an image"}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:y,disabled:d})]})}),d&&e.jsx("div",{className:"text-center text-gray-600",children:"Processing image..."}),e.jsx("button",{onClick:n,className:"w-full mt-4 px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300",children:"Cancel"})]})]})})},B={coral:"#F38181",teal:"#4ECAC7",yellow:"#FEC43C"};function mr(){const[r,s]=a.useState(""),[n,d]=a.useState([]),[b,p]=a.useState([]),[y,v]=a.useState(""),[N,j]=a.useState(""),[c,_]=a.useState(null),[w,k]=a.useState(""),[S,g]=a.useState([]),[E,C]=a.useState(""),[K,f]=a.useState(null);a.useState([]);const[P,A]=a.useState([]),[R,W]=a.useState(!1),[J,F]=a.useState(!1),[U,D]=a.useState(!1),[u,$]=a.useState(!1),[Q,O]=a.useState([]),[ee,re]=a.useState(!1),{language:i,toggleLanguage:X,direction:ce}=G(),m=V(i),[H,te]=a.useState(!0);a.useEffect(()=>{(async()=>{try{const[l,h,x]=await Promise.all([lr(),_e(),ge()]);d(l),p(h),g(x)}catch(l){console.error("Error loading initial data:",l)}})()},[]),a.useEffect(()=>{(async()=>{try{let l=null;r==="return"?l=E||null:r==="borrow"&&(l=N||null);const h=await Z(l,R),x=await Promise.all(h.map(async L=>{try{const Y=await ve(L.id);return{...L,last_reminder_date:Y?Y.sent_at:null}}catch(Y){return console.error(`Failed to fetch reminder for loan_id ${L.id}:`,Y),{...L,last_reminder_date:null}}}));A(ne(x))}catch(l){console.error("Error fetching loan history:",l),A([])}})()},[R,r,E,N]),a.useEffect(()=>{_(null),j(""),f(null),C(""),k(""),v(null)},[r]);const oe=n.map(t=>({value:t.id,label:H?t.parent_name:t.kid_name,parentName:t.parent_name,childName:t.kid_name})),se=b.map(t=>({value:t.qr_code,label:t.title})),ue=t=>{if(!t.returned_at){const l=S.find(h=>h.id===t.book_id);l?(f(l),C(l.qr_code),_(l),k(l.delivery_status||""),window.scrollTo({top:0,behavior:"smooth"})):alert("Book not found in borrowed books.")}},me=(t,l)=>{t.stopPropagation(),t.target.checked?O([...Q,l]):O(Q.filter(h=>h.id!==l.id))},he=async()=>{re(!0);try{const t=await Promise.all(Q.map(async x=>{try{const L=await cr(x.id,"Book Return Reminder",{borrower_name:x.borrower_name,book_title:x.book_title,borrowed_at:x.borrowed_at},i);if(L.success){console.log(`Reminder sent successfully for loan_id: ${x.id}`);const Y=new Date().toISOString().slice(0,19).replace("T"," ");A(pe=>pe.map(z=>z.id===x.id?{...z,last_reminder_date:Y}:z));const le=await ve(x.id);le!=null&&le.sent_at&&A(pe=>pe.map(z=>z.id===x.id?{...z,last_reminder_date:le.sent_at}:z))}else console.error(`Failed to send reminder for loan_id: ${x.id} - ${L.error}`);return{success:L.success,loanId:x.id,error:L.error}}catch(L){return console.error(`Error sending reminder for loan_id ${x.id}:`,L),{success:!1,loanId:x.id,error:L.message}}})),l=t.filter(x=>x.success).length,h=t.filter(x=>!x.success);if(l>0&&alert(`Sent ${l} reminders successfully!`),h.length>0){const x=h.map(L=>`Loan ID: ${L.loanId} - ${L.error}`).join(`
`);alert(`Failed to send ${h.length} reminders.

${x}`)}O([]),$(!1)}catch(t){console.error("Failed to send reminders:",t),alert("Failed to send reminders. Please check your email service configuration.")}finally{re(!1)}},be=async t=>{const l=t.target.checked;W(l);try{let h=null;r==="return"?h=E||null:r==="borrow"&&(h=N||null);const x=await Z(h,l);A(ne(x))}catch(h){console.error("Error fetching loan history:",h),A([])}},ae=async()=>{D(!0),F(!0)},o=async t=>{try{console.log("Handling scan result..."),F(!1),D(!0);const l=await nr(t);if(l)if(r==="borrow"?(j(t),_(l)):r==="return"&&(C(t),f(l),_(l),f(l)),k(l.delivery_status),l.loan_status==="borrowed"){const h=await Z(t);if(h&&h.length>0){const x=h[0];alert(`The book "${l.title}" was borrowed by ${x.borrower_name} on ${x.borrowed_at}.`)}else alert(`The book "${l.title}" is marked as borrowed, but no loan history is available.`)}else alert(`The book "${l.title}" is available.`);else alert("Book not found for the given QR code.")}catch(l){console.error("Error processing scan result:",l),alert("An error occurred while processing the QR code.")}finally{D(!1)}},I=t=>{console.error("QR Scan Error:",t),F(!1),D(!1),alert("Failed to scan QR code. Please try again.")},Ce=()=>{F(!1),D(!1)},Be=async()=>{if(y&&c&&w)try{if((await ir(c.qr_code,y.id,w)).message){alert("Book borrowed successfully!"),_(null),v(null),k("");const l=await _e(),h=await ge(),x=await Z(null,R);p(l),g(h),A(ne(x))}else alert("Error borrowing book.")}catch(t){console.error("Failed to borrow book:",t)}else alert("Please select a borrower, book, and book state.")},Le=async()=>{if(!E){alert("Please select a book to return.");return}try{if((await dr(E)).success){alert("Book returned successfully!"),f(null),C(""),_(null),k("");const l=await _e(),h=await ge(),x=await Z(null,R);p(l),g(h),A(ne(x))}else alert("Failed to return the book. Please try again.")}catch(t){console.error("Error returning book:",t),alert("An error occurred while returning the book. Please try again.")}},ne=t=>t.sort((l,h)=>!l.return_date&&h.return_date?-1:l.return_date&&!h.return_date?1:new Date(h.loan_start_date)-new Date(l.loan_start_date));return e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-6",children:[J&&e.jsx("div",{className:"scanner-modal",children:e.jsx(ur,{onScanSuccess:o,onScanError:I,onScanCancel:Ce})}),e.jsxs("div",{className:"flex gap-4 mb-4",children:[e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx("button",{className:"w-12 h-12 flex items-center justify-center rounded-full border border-teal-500 bg-white text-teal-500 shadow-md",onClick:X,children:i==="en"?"HE":"EN"})}),e.jsx("button",{className:`flex-1 py-2 px-4 rounded ${r==="borrow"?"text-white":"text-gray-800"}`,style:{backgroundColor:r==="borrow"?B.coral:"transparent",borderColor:B.coral,borderWidth:"1px"},onClick:()=>s("borrow"),children:m.borrow}),e.jsx("button",{className:`flex-1 py-2 px-4 rounded ${r==="return"?"text-white":"text-gray-800"}`,style:{backgroundColor:r==="return"?B.coral:"transparent",borderColor:B.coral,borderWidth:"1px"},onClick:()=>s("return"),children:m.return})]}),r==="borrow"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(we,{options:oe,placeholder:H?m.parent_name_placeholder:m.kid_name_placeholder,value:y?{value:y.id,label:H?y.parent_name:y.kid_name}:null,onChange:t=>{if(t){const l=n.find(h=>h.id===t.value||h.parent_name===t.label||h.kid_name===t.label);v(l||null)}else v(null)},isClearable:!0,styles:{control:t=>({...t,borderColor:B.coral,borderRadius:"4px",boxShadow:"none","&:hover":{borderColor:B.teal}})},className:"w-full flex-grow",classNamePrefix:"borrower-select"}),e.jsx("button",{onClick:()=>te(!H),className:`relative inline-flex h-6 w-16 items-center rounded-full transition-colors duration-200 ease-in-out ${H?"bg-teal-600":"bg-gray-200"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-gray-300 transition duration-200 ease-in-out ${H?"translate-x-6":"translate-x-1"}`})}),e.jsx("span",{className:"text-sm text-gray-600",children:H?m.parent_name_borrower:m.kid_name_borrower})]}),e.jsx(we,{options:se,placeholder:m.Select_Book,value:c?{value:c.qr_code,label:c.title}:null,onChange:t=>{const l=b.find(h=>h.qr_code===(t==null?void 0:t.value));_(l||null),j((t==null?void 0:t.value)||""),k((l==null?void 0:l.delivery_status)||"")},isClearable:!0,styles:{control:t=>({...t,borderColor:B.coral,borderRadius:"4px",boxShadow:"none","&:hover":{borderColor:B.teal}})},className:"w-full",classNamePrefix:"book-select"}),c&&e.jsxs("div",{className:`bg-gray-100 p-4 rounded mt-4 ${i==="he"?"rtl":""}`,children:[e.jsx("h3",{className:"font-bold text-lg",children:c.title}),e.jsxs("p",{className:"text-sm",children:[m.author,": ",c.author]}),e.jsxs("p",{className:"text-sm",children:[m.description,": ",c.description]}),e.jsxs("p",{className:"text-sm",children:[m.year_of_publication,": ",c.year_of_publication]}),e.jsxs("p",{className:"text-sm",children:[m.cover_type,": ",c.cover_type]}),e.jsxs("p",{className:"text-sm",children:[m.pages,": ",c.pages]}),e.jsxs("p",{className:"text-sm",children:[m.recommended_age,": ",c.recommended_age]}),e.jsxs("p",{className:"text-sm",children:[m.Select_Book_State,": ",c.book_condition]})]}),c&&e.jsxs("select",{className:"w-full p-2 border rounded mt-2",style:{borderColor:B.coral},onChange:t=>k(t.target.value),value:w,children:[e.jsx("option",{value:"",children:m.Select_Book_State}),e.jsx("option",{value:"כמו חדש",children:m.new}),e.jsx("option",{value:"מצויין - בלאי בלתי מורגש",children:m.good}),e.jsx("option",{value:"טוב - בלאי קל",children:m.worn})]}),e.jsxs("button",{className:"w-full flex items-center justify-center py-2 px-4 rounded text-white",style:{backgroundColor:B.coral},onClick:ae,children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),m.ScanQR]}),e.jsx("button",{className:"w-full py-2 px-4 rounded text-white mt-2",style:{backgroundColor:B.coral},onClick:Be,children:m.borrow}),e.jsx("div",{className:`loan-history-container ${i==="he"?"rtl":""}`,children:b.map(t=>e.jsxs("div",{className:`loan-history-card ${(c==null?void 0:c.qr_code)===t.qr_code?"active-loan":""} ${i==="he"?"rtl":""}`,onClick:()=>{_(t),j(t.qr_code),k(t.delivery_status||"")},style:{cursor:"pointer"},children:[e.jsx("div",{className:"loan-history-card-header",children:e.jsx("h3",{className:"loan-history-card-title",children:t.title})}),e.jsxs("div",{className:"loan-history-card-body",children:[e.jsxs("p",{className:"loan-history-card-detail",children:[m.author,": ",t.author]}),e.jsxs("p",{className:"loan-history-card-detail",children:[m.year_of_publication,": ",t.year_of_publication]}),e.jsxs("p",{className:"loan-history-card-detail",children:[m.pages,": ",t.pages]}),e.jsxs("p",{className:"loan-history-card-detail",children:[m.recommended_age,": ",t.recommended_age]})]})]},t.qr_code))})]}),r==="return"&&e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"mt-4",children:e.jsxs("select",{value:E||"",onChange:t=>{const l=t.target.value;C(l);const h=S.find(x=>x.qr_code===l);h&&(_(h),k(h.delivery_status||""))},className:"w-full p-2 border rounded",style:{borderColor:B.coral},children:[e.jsx("option",{value:"",children:m.Select_Book}),S.map(t=>e.jsx("option",{value:t.qr_code,children:t.title},t.qr_code))]})}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("button",{className:"w-full flex items-center justify-center py-2 px-4 rounded text-white",style:{backgroundColor:B.coral},onClick:ae,children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),m.ScanQR]}),e.jsx("button",{className:"w-full py-2 px-4 rounded text-white mt-2",style:{backgroundColor:B.coral},onClick:Le,disabled:!K,children:m.return}),e.jsxs("button",{className:"w-full flex items-center justify-center py-2 px-4 rounded text-white mt-2",style:{backgroundColor:B.teal},onClick:()=>$(!u),children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),m.SendReminders]})]}),e.jsx("div",{className:"flex items-center my-4",children:e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:t=>be({target:{checked:!R}}),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors duration-200 ease-in-out ${R?"bg-teal-600":"bg-gray-200"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition duration-200 ease-in-out ${R?"translate-x-6":"translate-x-1"}`})}),e.jsx("span",{className:"text-sm text-gray-600",children:m.ShowAllLoans})]})}),u&&P.filter(t=>!t.returned_at).length>0&&e.jsxs("div",{className:"reminder-section bg-gray-100 p-4 rounded-lg mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:m.SendReminders}),e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:Q.length===P.filter(t=>!t.returned_at).length,onChange:t=>{if(t.target.checked){const l=P.filter(h=>!h.returned_at);O(l)}else O([])},className:"w-4 h-4 text-teal-500 border-gray-300 rounded focus:ring-teal-500 cursor-pointer"}),e.jsx("span",{className:"ml-2",children:m.select_all})]})]}),e.jsx("button",{className:"w-full py-2 px-4 rounded text-white",style:{backgroundColor:B.coral},onClick:he,disabled:Q.length===0||ee,children:ee?m.sending_reminders:m.send_x_reminders.replace("{count}",Q.length)})]}),P.length>0&&e.jsx("div",{className:`loan-history-container ${i==="he"?"rtl":""}`,children:P.map(t=>e.jsxs("div",{className:`loan-history-card ${t.returned_at?"":"active-loan"} ${i==="he"?"rtl":""}`,onClick:()=>r==="return"&&ue(t),children:[e.jsxs("div",{className:"loan-history-card-header",children:[u&&!t.returned_at&&e.jsx("div",{onClick:l=>l.stopPropagation(),children:e.jsxs("label",{className:"custom-checkbox",children:[e.jsx("input",{type:"checkbox",checked:Q.some(l=>l.id===t.id),onChange:l=>me(l,t),className:"hidden-checkbox"}),e.jsx("span",{className:"checkbox-mark"})]})}),e.jsx("div",{className:"loan-history-card-title",children:t.book_title})]}),e.jsxs("div",{className:"loan-history-card-body",children:[e.jsxs("div",{className:"loan-history-card-detail",children:[m.borrowed_by," ",t.borrower_name]}),e.jsxs("div",{className:"loan-history-card-detail",children:[m.kid_name_borrower,": ",t.borrower_child||"N/A"]}),e.jsxs("div",{className:"loan-history-card-detail",children:[m.borrow_date,": ",t.borrowed_at]}),t.returned_at&&e.jsxs("div",{className:"loan-history-card-detail",children:[m.return_date,": ",t.returned_at]}),e.jsxs("div",{className:"loan-history-card-detail",children:[m.delivery_status,": ",t.book_state||"N/A"]}),t.last_reminder_date?e.jsxs("div",{className:"loan-history-card-detail",children:[m.last_reminder,": ",t.last_reminder_date]}):e.jsx("div",{className:"loan-history-card-detail no-reminder",children:m.no_reminder_sent})]})]},t.id))})]})]})}const Se=navigator.language||"en-US",hr=async(r="desc",s="title",n=!0)=>{try{const d=new URLSearchParams({order_by:r,sort_column:s,include_history:n.toString()});return(await T.get(`${q}/api/generate_books_report?${d.toString()}`,{headers:{"Accept-Language":Se},responseType:"blob"})).data}catch(d){throw console.error("Error generating books report:",d),d}},br=async(r="desc",s="title",n=!1)=>{try{const d=new URLSearchParams({order_by:r,sort_column:s,include_borrowed:n.toString()});return(await T.get(`${q}/api/generate_inventory_report?${d.toString()}`,{headers:{"Accept-Language":Se},responseType:"blob"})).data}catch(d){throw console.error("Error generating inventory report:",d),d}},pr=()=>{const{language:r,toggleLanguage:s}=G(),n=V(r),[d,b]=a.useState(!1),[p,y]=a.useState(!0),[v,N]=a.useState("desc"),[j,c]=a.useState(""),[_,w]=a.useState(""),k={inventory:[{value:"title",label:n.book_title},{value:"author",label:n.author},{value:"id",label:n.id},{value:"loan_status",label:n.loan_status}],loans:[{value:"title",label:n.book_title},{value:"author",label:n.author},{value:"id",label:n.id}]},S=async()=>{try{let g;_==="inventory"?g=await br(v,j,p):_==="loans"&&(g=await hr(v,j,d));const E=window.URL.createObjectURL(new Blob([g])),C=document.createElement("a");C.href=E,C.setAttribute("download",`${_}_report.xlsx`),document.body.appendChild(C),C.click()}catch(g){console.error("Error generating report:",g),alert(n.error_generating_report)}};return e.jsxs("div",{className:`report-container ${r==="he"?"rtl":""}`,dir:r==="he"?"rtl":"ltr",children:[e.jsx("button",{className:"w-12 h-12 flex items-center justify-center rounded-full border border-teal-500 bg-white/50 text-teal-500 shadow-md absolute top-2 left-2",onClick:s,children:r==="en"?"HE":"EN"}),e.jsxs("div",{className:"p-4 bg-white rounded-lg shadow-md",children:[e.jsxs("div",{className:"flex items-center justify-center mb-4",children:[e.jsx($e,{className:"w-6 h-6 mr-2 text-teal-500"}),e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:n.reports})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",dir:r==="he"?"rtl":"ltr",children:[e.jsxs("h3",{className:"text-md font-semibold text-teal-600 mb-3 flex items-center",children:[e.jsx(qe,{className:"w-4 h-4 mr-2"}),n.select_report_type]}),e.jsx("div",{className:"space-y-2",dir:r==="he"?"rtl":"ltr",children:["inventory","loans"].map(g=>e.jsx("button",{onClick:()=>w(g),className:`w-full p-2 rounded-lg text-left text-sm ${_===g?"bg-teal-500 text-white shadow-md":"bg-white text-gray-700 hover:bg-gray-100 border border-gray-200"}`,children:g==="inventory"?n.inventory_report:n.loans_report},g))})]}),e.jsx("div",{className:`bg-white p-4 rounded-lg border border-gray-100 ${_?"":"opacity-50 pointer-events-none"}`,children:_&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-md font-semibold text-teal-600 mb-3 flex items-center",children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),n.report_options]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[_==="loans"&&e.jsx("div",{className:"flex items-center col-span-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>b(!d),className:`relative inline-flex h-6 w-10 items-center rounded-full transition-colors duration-200 ease-in-out ${d?"bg-teal-600":"bg-gray-200"}`,children:e.jsx("span",{className:`absolute left-1 top-1 h-4 w-4 transform rounded-full bg-white transition duration-200 ease-in-out ${d?r==="he"?"translate-x-[1px]":"translate-x-4":r==="he"?"translate-x-4":"translate-x-[1px]"}`})}),e.jsx("span",{className:"text-sm text-gray-600",children:n.include_history})]})}),_==="inventory"&&e.jsx("div",{className:"flex items-center col-span-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>y(!p),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors duration-200 ease-in-out ${p?"bg-teal-600":"bg-gray-200"}`,children:e.jsx("span",{className:`absolute left-1 top-1 h-4 w-4 transform rounded-full bg-white transition duration-200 ease-in-out ${p?r==="he"?"translate-x-[1px]":"translate-x-4":r==="he"?"translate-x-4":"translate-x-[1px]"}`})}),e.jsx("span",{className:"text-sm text-gray-600",children:n.include_borrowed})]})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{children:n.sort_by}),e.jsxs("select",{value:j,onChange:g=>c(g.target.value),className:"border rounded-md",children:[e.jsx("option",{value:"",children:n.select_field}),k[_].map(g=>e.jsx("option",{value:g.value,children:g.label},g.value))]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{children:n.order}),e.jsxs("select",{value:v,onChange:g=>N(g.target.value),className:"border rounded-md",children:[e.jsx("option",{value:"asc",children:n.ascending}),e.jsx("option",{value:"desc",children:n.descending})]})]})]}),e.jsxs("button",{onClick:S,disabled:!j,className:"w-full p-2 bg-teal-500 text-white rounded-md",children:[n.generate_report_button," ",e.jsx(Pe,{className:"w-4 h-4 mr-2"})]})]})})]})]})]})},_r="/icm_lib/assets/banner_nobg-ldt_Oxdo.png";function gr(){const[r,s]=a.useState(!1),n=()=>{s(!0)};return e.jsx(ze,{children:r?e.jsx(xr,{}):e.jsx(We,{onLogin:n})})}function xr(){const{language:r}=G(),s=V(r);return e.jsxs("div",{className:"app-container min-h-screen bg-blend-screen max-w-md mx-auto",children:[e.jsx("header",{className:"bg-white drop-shadow-2xl rounded-full",children:e.jsxs("div",{className:"banner-container",children:[e.jsx("img",{src:_r,alt:"ICM Library Logo",className:"banner-logo"}),e.jsx("div",{className:"banner-text",children:e.jsx("p",{className:"text-sm text-gray-600",children:s.app_title})})]})}),e.jsx("div",{className:"max-w-md mx-auto",children:e.jsxs(He,{defaultValue:"inventory",className:"tabs-content",children:[e.jsxs(Qe,{className:"tabs-list w-full shadow-md rounded-lg grid grid-cols-4",children:[e.jsxs(ie,{value:"inventory",className:"tab-item flex items-center justify-center data-[state=active]:bg-teal-500 data-[state=active]:text-white text-gray-800 py-2 rounded-t-lg hover:bg-gray-100",children:[e.jsx(De,{className:"w-4 h-4 mr-2"}),s.books]}),e.jsxs(ie,{value:"members",className:"tab-item flex items-center justify-center data-[state=active]:bg-[#FDB813] data-[state=active]:text-white text-gray-800 py-2 rounded-t-lg hover:bg-gray-100",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),s.members]}),e.jsxs(ie,{value:"loans",className:"tab-item flex items-center justify-center data-[state=active]:bg-red-500 data-[state=active]:text-white text-gray-800 py-2 rounded-t-lg hover:bg-gray-100",children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),s.loans]}),e.jsxs(ie,{value:"reports",className:"tab-item flex items-center justify-center data-[state=active]:bg-purple-500 data-[state=active]:text-white text-gray-800 py-2 rounded-t-lg hover:bg-gray-100",children:[e.jsx(Te,{className:"w-4 h-4 mr-2"}),s.reports]})]}),e.jsx("div",{style:{height:"15px"}}),e.jsx(de,{value:"inventory",children:e.jsx(sr,{})}),e.jsx(de,{value:"members",children:e.jsx(ar,{})}),e.jsx(de,{value:"loans",children:e.jsx(mr,{})}),e.jsx(de,{value:"reports",children:e.jsx(pr,{})})]})})]})}Ee(document.getElementById("root")).render(e.jsx(a.StrictMode,{children:e.jsx(gr,{})}));
