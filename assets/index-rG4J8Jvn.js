import{r as n,j as e}from"./react-Dl5khTFu.js";import{c as qe}from"./react-dom-CaK7Gm4w.js";import{a as Y}from"./axios-upsvKRUO.js";import{C as fe,a as ye,S as Ce,T as we,I as Ae,Q as de,M as Ie,b as De,F as Qe,c as Me,D as Pe,L as Te,d as ve,U as je,B as Ne}from"./lucide-react-DzDcFL6R.js";import{S as ke}from"./react-select-DNjq-Jfl.js";import{H as Fe}from"./html5-qrcode-CAPQZwmQ.js";import{T as He,a as Oe,b as Ue,c as ie}from"./@radix-ui-FaNOjPFF.js";import"./hoist-non-react-statics-DUIF_pJT.js";import"./react-is-8JwjhRSi.js";import"./scheduler-CylivXx-.js";import"./@babel-DeGXz7kM.js";import"./@emotion-C1jRIs2C.js";import"./stylis-YPZU7XtI.js";import"./@floating-ui-DZ2V_EUC.js";import"./use-isomorphic-layout-effect-Do5Xa1W_.js";import"./memoize-one-DxrTgWdQ.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const p of document.querySelectorAll('link[rel="modulepreload"]'))c(p);new MutationObserver(p=>{for(const m of p)if(m.type==="childList")for(const y of m.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&c(y)}).observe(document,{childList:!0,subtree:!0});function o(p){const m={};return p.integrity&&(m.integrity=p.integrity),p.referrerPolicy&&(m.referrerPolicy=p.referrerPolicy),p.crossOrigin==="use-credentials"?m.credentials="include":p.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function c(p){if(p.ep)return;p.ep=!0;const m=o(p);fetch(p.href,m)}})();const ze="/icm_lib/assets/img-Dm6ee46N.png",Ye="/icm_lib/assets/bookshelf-8M74edYe.png",O="https://religious-cherianne-dbprops-ef8ee171.koyeb.app",Be=n.createContext(),Ke=({children:r})=>{const[s,o]=n.useState("he"),c=m=>m==="he"?"rtl":"ltr",p=()=>{o(m=>m==="en"?"he":"en")};return e.jsx(Be.Provider,{value:{language:s,setLanguage:o,toggleLanguage:p,direction:c(s)},children:r})},Z=()=>n.useContext(Be),Ge={by:"by",app_title:"Israeli Community of Madrid Library",title:"Book Title",author:"Author",description:"Description",year_of_publication:"Year of Publication",cover_type:"Cover Type",pages:"Pages",borrowing_child:"Borrowing Child's Name",borrowed_by:"Borrowed By",borrower:"Borrower",borrow:"Borrow Book",delivery_status:"Delivery Status",delivering_parent:"Delivering Parent",recommended_age:"Recommended Age",borrow_date:"Borrow Date",return_date:"Return Date",NotReturned:"Not Returned",add_book_label:"Add New Book",books:"Books",members:"Members",loans:"Loans",ShowAllLoans:"Show History",Hide_Details:"Hide Details",More_Details:"More Details",loan_status:"Availability",sort_by:"Order by",ascending:"Ascending",descending:"Descending",Hide_Add_Book:"Hide Add Book",Add_Book:"Add Book",return:"Return Book",Select_Book:"Select Book",Select_Book_State:"Select Book State",ScanQR:"Scan QR Code",download_qr_code:"Download QR Code",SendReminders:"Send Reminders",last_reminder:"last reminder at",no_reminder_sent:"No Reminders Sent",sending_reminders:"Sending...",send_x_reminders:"Send {count} Reminders",error_generating_report:"Failed to generate report. Please try again.",reports:"Reports",generate_report_button:"Generate report",select_borrower:"Select Borrower",add_member_button:"Add Member",edit_member:"Edit Member",delete_member:"Delete Member",close_add_member_button:"Close Add Member",add_member_form_title:"Add New Member",search_placeholder:"Search members by name",members_list_title:"Library Members",no_members_found:"No members found",select_all:"Select All",borrowed_books_label:"Borrowed books",parent_name_placeholder:"Parent's Name",kid_name_placeholder:"Kid's Name",parent_name_borrower:"Parent",kid_name_borrower:"Kid",email_placeholder:"Email Address",error_parent_name_required:"Parent's name is required.",error_kid_name_required:"Kid's name is required.",error_email_required:"Email address is required.",error_email_invalid:"Invalid email address.",email_missing_warning:"No email provided - notifications will not be sent to this member",confirm_delete_member:"Are you sure you want to delete this member?",no_email_provided:"No email provided",success_member_added:"Member added successfully!",success_member_updated:"Member updates successfully!",success_member_deleted:"Member deleted successfully!",parent_name_label:"Parent Name",kid_name_label:"Child Name",email_label:"Email",inventory_list_title:"Library Inventory",add_book_button:"Add Book",close_add_book_button:"Close Add Book",search_books_placeholder:"Search books by title",no_books_found:"No books found",placeholder_book_title:"Enter Book Title",placeholder_book_author:"Enter Author Name",placeholder_book_description:"Enter Description",placeholder_book_year:"Enter Year of Publication",placeholder_book_pages:"Enter Number of Pages",placeholder_book_recommended_age:"Enter Recommended Age",select_condition:"Select Condition",select_loan_status:"Select loan status",select_parent:"Select Parent",select_cover_type:"format",soft_cover:"Soft Cover",hard_cover:"Hard Cover",rigid_pages:"Rigid Pages",battery_book:"Book with Battery",new:"Like New",good:"Excellent - No noticeable wear",worn:"Good - Minor wear",available:"Available",borrowed:"Borrowed",error_book_title_required:"Book title is required.",error_book_author_required:"Author name is required.",error_book_description_required:"Description is required.",error_book_year_required:"Year of publication is required.",error_book_pages_required:"Number of pages is required.",cannot_delete_with_borrowed_books:"Cannot delete a member with borrowed books",inventory_report:"Inventory Report",loans_report:"Loans Report",select_report_type:"Select Report Type",report_options:"Report Options",select_field:"Select Field",book_title:"Book Title",id:"ID",order:"Order",include_history:"Include Historical Loans",include_borrowed:"Include Currently Borrowed Books",update_book_button:"Update book information",edit_book:"Edit book information",login_title:"Library Login",username:"Username",password:"Password",username_placeholder:"Enter username",password_placeholder:"Enter password",login_button:"Login",logging_in:"Logging in...",invalid_credentials:"Invalid username or password.",qr_codes_report:"Print QR Codes",qr_codes_available:"There are {count} QR codes available.",qr_codes_description:"This report generates a printable PDF of QR codes arranged in a grid with cutting guides.",inventory_report_description:"This report generates an Excel file with current inventory details. You can sort the data by various fields and choose to include borrowed items.",loans_report_description:"This report generates an Excel file of active loans. You can choose to include historical loans and sort by various fields.",start_qr:"From QR ID",end_qr:"End QR ID",end_qr_exceed_error:"End QR ID cannot exceed {qrCount}.",from_qr_greater_error:"From QR ID cannot be greater than To QR ID."},Ve={by:"על ידי",app_title:"ספריית הקהילה הישראלית במדריד",title:"שם הספר",author:"שם המחבר",description:"תיאור",year_of_publication:"שנת הוצאה",cover_type:"סוג כריכה",pages:"עמודים",borrowing_child:"שם הילד המשאיל",borrowed_by:"הושאל על ידי",borrower:"המשאיל",borrow:"השאל ספר",delivery_status:"מצב מסירה",delivering_parent:"שם ההורה המוסר",recommended_age:"גיל מומלץ",borrow_date:"תאריך השאלה",return_date:"תאריך החזרה",NotReturned:"לא הוחזר",add_book_label:"הוסף ספר חדש",books:"ספרים",members:"חברים",loans:"השאלות",ShowAllLoans:"הצג היסטוריה",Hide_Details:"הסתר פרטים",More_Details:"עוד פרטים",loan_status:"זמינות",sort_by:"סדר לפי",ascending:"עולה",descending:"יורד",Hide_Add_Book:"הסתר הוספת ספר",Add_Book:"הוסף ספר",return:"החזר ספר",Select_Book:"בחר ספר",Select_Book_State:"מצב הספר",ScanQR:"סרוק ברקוד",download_qr_code:"הורד ברקוד",SendReminders:"שלח תזכורת",last_reminder:"תזכורת אחרונה ב",no_reminder_sent:"לא נשלחה תזכורת",sending_reminders:"שולח...",send_x_reminders:"שלח {count} תזכורות",error_generating_report:"הפקת הדוח נכשלה, נסה שנית בבקשה.",reports:"דוחות",generate_report_button:"הפק דוח",select_borrower:"בחר משאיל",add_member_button:"הוסף חבר",edit_member:"ערוך",delete_member:"מחק חבר",close_add_member_button:"סגור הוספת חבר",add_member_form_title:"הוספת חבר חדש",search_placeholder:"חפש חברים לפי שם",members_list_title:"חברי הספרייה",no_members_found:"לא נמצאו חברים",select_all:"בחר הכל",borrowed_books_label:"ספרים מושאלים",parent_name_placeholder:"שם ההורה המשאיל",kid_name_placeholder:"שם הילד המשאיל",parent_name_borrower:"ההורה",kid_name_borrower:"הילד",email_placeholder:"כתובת אימייל",error_parent_name_required:"נדרש שם הורה.",error_kid_name_required:"נדרש שם ילד.",error_email_required:"נדרשת כתובת אימייל.",error_email_invalid:"כתובת אימייל לא תקינה.",email_missing_warning:"לא סופק אימייל - לא יישלחו התראות לחבר זה",no_email_provided:"לא סופק אימייל",success_member_added:"החבר נוסף בהצלחה!",success_member_updated:"החבר עודכן בהצלחה!",success_member_deleted:"חבר נמחק בהצלחה!",parent_name_label:"שם ההורה",kid_name_label:"שם הילד",email_label:"אימייל",inventory_list_title:"מלאי הספרייה",add_book_button:"הוסף ספר",close_add_book_button:"סגור הוספת ספר",search_books_placeholder:"חפש ספרים לפי שם",no_books_found:"לא נמצאו ספרים",placeholder_book_title:"הכנס שם הספר",placeholder_book_author:"הכנס שם המחבר",placeholder_book_description:"הכנס תיאור",placeholder_book_year:"הכנס שנת הוצאה",placeholder_book_pages:"הכנס מספר עמודים",placeholder_book_recommended_age:"הכנס גיל מומלץ",select_condition:"מצב מסירה",select_loan_status:"זמינות",select_parent:"שם ההורה",select_cover_type:"פורמט",soft_cover:"כריכה רכה",hard_cover:"כריכה קשה",rigid_pages:"עמודים קשיחים",battery_book:"ספר עם בטריה",new:"כמו חדש",good:"מצויין - בלאי בלתי מורגש",worn:"טוב - בלאי קל",available:"זמין",borrowed:"מושאל",error_book_title_required:"נדרש שם ספר.",error_book_author_required:"נדרש שם מחבר.",error_book_description_required:"נדרש תיאור.",error_book_year_required:"נדרשת שנת הוצאה.",error_book_pages_required:"נדרש מספר עמודים.",confirm_delete_member:"האם אתה בטוח שברצונך למחוק חבר זה?",cannot_delete_with_borrowed_books:"לא ניתן למחוק חבר עם השאלות פתוחות",inventory_report:"דוח מלאי",loans_report:"דוח השאלות",select_report_type:"בחר סוג דוח",report_options:"אפשרויות דוח",select_field:"בחר שדה",book_title:"כותרת הספר",id:"מזהה",order:"סדר",include_history:"כלול היסטורית השאלות",include_borrowed:"כלול ספרים מושאלים",update_book_button:"עדכון ספר",edit_book:"ערוך ספר",login_title:"כניסה לספרייה",username:"שם משתמש",password:"סיסמה",username_placeholder:"הכנס שם משתמש",password_placeholder:"הכנס סיסמה",login_button:"כניסה",logging_in:"מתחבר...",invalid_credentials:"שם משתמש או סיסמה לא נכונים.",qr_codes_report:"הדפס קודי QR",qr_codes_available:"ישנם {count} קודי QR זמינים.",qr_codes_description:"דוח זה יפיק קובץ PDF להדפסה של קודי QR המסודרים ברשת עם קווים לחיתוך.",inventory_report_description:"דוח זה מייצר קובץ Excel עם פרטי המלאי הנוכחי. ניתן למיין את הנתונים לפי שדות שונים ולבחור לכלול פריטים מושאלים.",loans_report_description:"דוח זה מייצר קובץ Excel של הלוואות פעילות. ניתן לבחור לכלול הלוואות היסטוריות ולמיין לפי שדות שונים.",start_qr:"ממזהה QR",end_qr:"עד מזהה QR",end_qr_exceed_error:"מספר ה-QR הסופי לא יכול להיות גדול מ-{qrCount}.",from_qr_greater_error:"מספר ה-QR ההתחלתי לא יכול להיות גדול ממספר ה-QR הסופי."},ee=r=>r==="he"?Ve:Ge,We=(r,s)=>({"כריכה רכה":s.soft_cover,"כריכה קשה":s.hard_cover,"עמודים קשיחים":s.rigid_pages,"ספר עם בטריה":s.battery_book})[r]||"N/A",Je=(r,s)=>({"כמו חדש":s.new,"מצויין - בלאי בלתי מורגש":s.good,"טוב - בלאי קל":s.worn})[r]||"N/A",Xe=({onLogin:r})=>{const[s,o]=n.useState(""),[c,p]=n.useState(""),[m,y]=n.useState(""),[j,C]=n.useState(!1),{language:N,toggleLanguage:b,direction:h}=Z(),w=ee(N),v=async B=>{B.preventDefault(),C(!0);try{const k=await Y.post(`${O}/api/login`,{username:s,password:c});k.status===200&&(localStorage.setItem("authToken",k.data.token),r())}catch{y(w.invalid_credentials)}C(!1)};return e.jsxs("div",{className:`min-h-screen relative flex items-center justify-center ${h==="rtl"?"rtl":"ltr"}`,children:[e.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat opacity-20",style:{backgroundImage:`url(${Ye})`,backgroundSize:"cover",backgroundPosition:"center",zIndex:0}}),e.jsx("button",{className:"w-10 h-10 flex items-center justify-center rounded-full border border-teal-500 bg-white/40 text-teal-500 shadow-md absolute top-2 left-2",onClick:()=>{b(),document.documentElement.dir=h==="rtl"?"ltr":"rtl"},style:{zIndex:50},children:N==="en"?"HE":"EN"}),e.jsxs("div",{className:"relative z-10 w-full max-w-[320px] sm:max-w-[380px] mx-4 rounded-3xl overflow-hidden shadow-xl",children:[e.jsx("div",{className:"bg-white rounded-3xl p-4",children:e.jsx("img",{src:ze,alt:"ICM Library Logo",className:"h-12 sm:h-16 w-auto mx-auto"})}),e.jsx("div",{className:"transition-all duration-300",children:e.jsxs("form",{onSubmit:v,className:"backdrop-blur-sm bg-white/20 p-6 sm:p-8 rounded-3xl",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold mb-4 sm:mb-6 text-center text-gray-800",children:w.login_title}),m&&e.jsx("div",{className:"text-red-500 text-sm mb-4 bg-red-50 p-2 rounded",children:m}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-medium mb-2",children:w.username}),e.jsx("input",{type:"text",className:`w-full p-2.5 sm:p-3 border border-gray-200 rounded-md\r
                                             bg-white/50 backdrop-blur-sm focus:ring-2\r
                                             focus:ring-blue-500 focus:border-transparent`,value:s,onChange:B=>o(B.target.value),placeholder:w.username_placeholder,dir:h==="rtl"?"rtl":"ltr"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-medium mb-2",children:w.password}),e.jsx("input",{type:"password",className:`w-full p-2.5 sm:p-3 border border-gray-200 rounded-md\r
                                             bg-white/50 backdrop-blur-sm focus:ring-2\r
                                             focus:ring-blue-500 focus:border-transparent`,value:c,onChange:B=>p(B.target.value),placeholder:w.password_placeholder,dir:h==="rtl"?"rtl":"ltr"})]}),e.jsx("button",{type:"submit",className:`w-full py-2.5 sm:py-3 rounded-md transition duration-200 
                                         ${j?"bg-gray-400 cursor-not-allowed":"bg-blue-500 hover:bg-blue-600 active:bg-blue-700"} text-white font-semibold shadow-md`,disabled:j,children:j?w.logging_in:w.login_button})]})]})})]})]})},L=Y.create({baseURL:O});L.interceptors.request.use(r=>{const s=localStorage.getItem("authToken");return console.log("Token in localStorage:",s),s&&(r.headers.Authorization=s),r},r=>Promise.reject(r));L.interceptors.response.use(r=>r,r=>(r.response&&r.response.status===403&&(localStorage.removeItem("authToken"),alert("Session expired. Please log in again."),window.location.reload()),Promise.reject(r)));const Ze=async r=>{try{return(await L.post("/api/members",r)).data}catch{throw new Error("Failed to add member.")}},Ee=async()=>{try{return(await L.get("/api/members")).data.map(s=>({...s,borrowed_books_count:s.borrowed_books_count||0}))}catch(r){throw console.error("Error fetching members:",r),r}},er=async r=>{try{return(await L.get(`/api/members/${r}/loans`)).data.loans}catch(s){throw console.error(`Error fetching loans for member ${r}:`,s),s}},rr=async(r,s)=>{try{return(await L.put(`/api/members/${r}`,s)).data}catch(o){throw console.error("Error updating member:",o),o}},tr=async r=>{try{return(await L.delete(`/api/members/${r}`)).data}catch(s){throw console.error("Error deleting member:",s),s}},or=async(r="desc")=>{try{return(await Y.get(`${O}/api/books?order_by=${r}`)).data}catch(s){throw console.error("Error fetching books:",s),s}},sr=async r=>{try{return(await L.post("/api/books",r,{headers:{"Content-Type":"application/json"}})).data}catch(s){throw console.error("Error adding book:",s),new Error("Failed to add book.")}},ar=async r=>{try{const s=await Y.get(`${O}/api/qr_codes/${r}`,{responseType:"blob"}),o=window.URL.createObjectURL(new Blob([s.data])),c=document.createElement("a");c.href=o,c.setAttribute("download",r),document.body.appendChild(c),c.click(),c.remove()}catch(s){throw console.error("Error downloading QR code:",s),s}},nr=async(r,s)=>{try{return(await L.put(`${O}/api/books/${r}`,s)).data}catch(o){throw console.error("Error updating book:",o),o}},lr=()=>{const[r,s]=n.useState([]),[o,c]=n.useState("desc"),[p,m]=n.useState(""),[y,j]=n.useState(""),[C,N]=n.useState(""),[b,h]=n.useState(""),[w,v]=n.useState(""),[B,k]=n.useState(""),[E,S]=n.useState(""),[U,x]=n.useState(""),[I]=n.useState("available"),[R,u]=n.useState(""),[A,Q]=n.useState([]),[F,W]=n.useState(!1),[P,K]=n.useState(""),[G,D]=n.useState({}),{language:M,toggleLanguage:J,direction:d}=Z(),l=ee(M),[z,ue]=n.useState(null),[_,H]=n.useState(""),te=[{value:"כריכה רכה",label:l.soft_cover},{value:"כריכה קשה",label:l.hard_cover},{value:"עמודים קשיחים",label:l.rigid_pages},{value:"ספר עם בטריה",label:l.battery_book}],oe=[{value:"כמו חדש",label:l.new},{value:"מצויין - בלאי בלתי מורגש",label:l.good},{value:"טוב - בלאי קל",label:l.worn}];n.useEffect(()=>{se(),me()},[o]),n.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[]);const se=async()=>{try{const a=await or(o);Array.isArray(a)?s(a):(console.error("Unexpected response format:",a),s([]))}catch(a){console.error("Failed to load books:",a),s([])}},me=async()=>{try{const a=await Ee();Q(a)}catch(a){console.error("Error fetching members:",a)}},he=async a=>{a.preventDefault();try{const T={title:p,author:y,description:C,year_of_publication:b,pages:w,cover_type:B,book_condition:E||"טוב - בלאי קל",recommended_age:U,loan_status:I,delivering_parent:R};z?await nr(z,T):await sr(T),ue(null),H(""),m(""),j(""),N(""),h(""),v(""),k(te[0].value),S(oe[0].value),u(""),W(!1),await se()}catch(T){console.error("Error saving book:",T)}},be=a=>{W(!0),ue(a.id),H(a.qr_code),m(a.title),j(a.author||""),N(a.description||""),h(a.year_of_publication||""),v(a.pages||""),k(a.cover_type||""),S(a.book_condition||""),x(a.recommended_age||""),u(a.delivering_parent||"")},pe=a=>{D(T=>({...T,[a]:!T[a]}))},ae=a=>{ar(a).then(()=>console.log("QR Code downloaded successfully")).catch(T=>console.error("Failed to download QR Code:",T))};return e.jsxs("div",{className:"w-full max-w-md mx-auto",children:[e.jsx("button",{className:"w-10 h-10 flex items-center justify-center rounded-full border border-teal-500 bg-white/50 text-teal-500 shadow-md absolute top-2 left-2",onClick:J,children:M==="en"?"HE":"EN"}),e.jsx("div",{className:"flex flex-col mb-4",children:e.jsx("input",{id:"search_by_name",type:"text",placeholder:l.search_books_placeholder,value:P,onChange:a=>K(a.target.value),className:`flex-1 border border-gray-300 rounded-md py-1.5 px-4 ${M==="he"?"text-right":"text-left"}`})}),e.jsx("button",{onClick:()=>W(!F),className:"w-full bg-blue-500 text-white font-semibold py-2 rounded-md hover:bg-blue-600 transition mb-4",children:F?`- ${l.close_add_book_button}`:`+ ${l.add_book_button}`}),F&&e.jsxs("form",{onSubmit:he,className:"mb-4",children:[e.jsx("input",{type:"text",value:p,onChange:a=>m(a.target.value),placeholder:l.placeholder_book_title,className:"input mb-2 w-full border border-gray-300 rounded-md py-2 px-4"}),e.jsx("input",{type:"text",value:y,onChange:a=>j(a.target.value),placeholder:l.placeholder_book_author,className:"input mb-2 w-full border border-gray-300 rounded-md py-2 px-4"}),e.jsx("textarea",{value:C,onChange:a=>N(a.target.value),onInput:a=>{a.target.style.height="auto",a.target.style.height=`${a.target.scrollHeight}px`},placeholder:l.placeholder_book_description,className:"input mb-2 w-full border border-gray-300 rounded-md py-2 px-4"}),e.jsx("input",{type:"number",value:b,onChange:a=>h(a.target.value),placeholder:l.placeholder_book_year,className:"input mb-2 w-full border border-gray-300 rounded-md py-2 px-4"}),e.jsxs("select",{value:B,onChange:a=>k(a.target.value),className:"input mb-2 w-full border border-gray-300 rounded-md py-2 px-4",children:[e.jsx("option",{value:"",children:l.select_cover_type}),te.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]}),e.jsx("input",{type:"number",value:w,onChange:a=>v(a.target.value),placeholder:l.placeholder_book_pages,className:"input mb-2 w-full border border-gray-300 rounded-md py-2 px-4"}),e.jsx("input",{type:"number",value:U,onChange:a=>x(a.target.value),placeholder:l.placeholder_book_recommended_age,className:"input mb-2 w-full border border-gray-300 rounded-md py-2 px-4"}),e.jsxs("select",{value:E,onChange:a=>S(a.target.value),className:"input mb-2 w-full border border-gray-300 rounded-md py-2 px-4",children:[e.jsx("option",{value:"",children:l.select_condition}),oe.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]}),e.jsxs("select",{value:R,onChange:a=>u(a.target.value),className:"input mb-2 w-full border border-gray-300 rounded-md py-2 px-4",children:[e.jsx("option",{value:"",children:l.select_parent}),A.map(a=>e.jsx("option",{value:a.parent_name,children:a.parent_name},a.id))]}),e.jsx("button",{type:"submit",className:"w-full bg-green-500 text-white font-semibold py-2 rounded-md hover:bg-green-600 transition",children:z?l.update_book_button:l.add_book_button})]}),e.jsxs("div",{className:`w-full border-b border-gray-300 bg-gray-100 py-2 px-4 flex ${M==="he"?"flex-row-reverse":"flex-row"} justify-between items-center cursor-pointer`,onClick:()=>c(o==="desc"?"asc":"desc"),"aria-label":l.sort_by,children:[e.jsx("span",{className:"font-semibold text-gray-700",children:l.title}),o==="desc"?e.jsx(fe,{size:20}):e.jsx(ye,{size:20})]}),e.jsx("div",{dir:d,children:e.jsx("div",{className:"overflow-y-auto max-h-screen border-t pt-4",children:r.filter(a=>a.title.toLowerCase().includes(P.toLowerCase())||a.author.toLowerCase().includes(P.toLowerCase())).map(a=>e.jsxs("div",{className:"bg-gray-50 shadow-sm rounded-lg p-4 mb-2 relative",children:[e.jsxs("div",{className:"mb-12",children:[e.jsx("h2",{className:"font-bold text-gray-800",children:a.title}),e.jsx("p",{className:"text-sm text-gray-500",children:a.author}),e.jsxs("p",{className:"text-sm mb-4",children:[e.jsx("span",{className:a.loan_status==="available"?"text-green-500":"text-red-500",children:a.loan_status==="borrowed"?l.borrowed:l.available}),a.loan_status==="borrowed"&&e.jsxs("span",{children:[" ",l.by," ",a.borrowing_child]})]}),e.jsx("button",{onClick:()=>ae(`${a.qr_code}.png`),className:"text-blue-600 text-sm px-3 py-1 rounded-md border border-blue-600 hover:bg-blue-50 transition-colors duration-200",children:l.download_qr_code})]}),e.jsxs("div",{className:"absolute bottom-4 inset-x-4 flex justify-between items-center",children:[e.jsx("button",{onClick:()=>be(a),className:"p-2 text-gray-600 hover:text-emerald-600 transition-colors duration-200","aria-label":l.edit_book,children:e.jsx(Ce,{size:20})}),e.jsx("button",{onClick:()=>pe(a.qr_code),className:"flex items-center gap-1 text-gray-600 hover:text-indigo-600 transition-colors duration-200",children:G[a.qr_code]?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm",children:l.Hide_Details}),e.jsx(ye,{size:20})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm",children:l.More_Details}),e.jsx(fe,{size:20})]})}),e.jsx("div",{className:"w-8","aria-hidden":"true"})]}),G[a.qr_code]&&e.jsxs("div",{className:"mt-8 mb-8 text-gray-600 bg-white p-4 rounded-md border border-gray-100",children:[e.jsxs("p",{children:[e.jsxs("strong",{children:[l.description,":"]})," ",a.description||"N/A"]}),e.jsxs("p",{children:[e.jsxs("strong",{children:[l.year_of_publication,":"]})," ",a.year_of_publication||"N/A"]}),e.jsxs("p",{children:[e.jsxs("strong",{children:[l.cover_type,":"]})," ",We(a.cover_type,l)]}),e.jsxs("p",{children:[e.jsxs("strong",{children:[l.pages,":"]})," ",a.pages||"N/A"]}),e.jsxs("p",{children:[e.jsxs("strong",{children:[l.recommended_age,":"]})," ",a.recommended_age||"N/A"]}),e.jsxs("p",{children:[e.jsxs("strong",{children:[l.select_condition,":"]})," ",Je(a.book_condition,l)]}),e.jsxs("p",{children:[e.jsxs("strong",{children:[l.delivering_parent,":"]})," ",a.delivering_parent||"N/A"]})]})]},a.qr_code))})})]})};function ir(){const[r,s]=n.useState([]),[o,c]=n.useState(""),[p,m]=n.useState(""),[y,j]=n.useState(""),[C,N]=n.useState(!1),[b,h]=n.useState(""),[w,v]=n.useState({}),[B,k]=n.useState(""),{language:E,toggleLanguage:S,direction:U}=Z(),x=ee(E),[I,R]=n.useState(null),[u,A]=n.useState(null),[Q,F]=n.useState({}),W=()=>{const d={};return o.trim()||(d.parentName=x.error_parent_name_required),p.trim()||(d.kidName=x.error_kid_name_required),y.trim()&&!/\S+@\S+\.\S+/.test(y)&&(d.email=x.error_email_invalid),v(d),Object.keys(d).length===0},P=async d=>{if(d.preventDefault(),!!W()){y.trim()||alert(x.email_missing_warning);try{const l={parent_name:o,kid_name:p,email:y};I?await rr(I,l):await Ze(l),R(null),c(""),m(""),j(""),v({}),k(I?x.success_member_updated:x.success_member_added),await D()}catch(l){console.error("Error saving member:",l),k("")}}},K=async d=>{if(window.confirm(x.confirm_delete_member))try{await tr(d),k(x.success_member_deleted),await D()}catch(l){console.error("Error deleting member:",l),alert("Cannot delete member: they have open loans.")}},G=d=>{R(d.id),c(d.parent_name),m(d.kid_name),j(d.email),N(!0)},D=async()=>{try{const d=await Ee();Array.isArray(d)?s(d):(console.error("Unexpected response format:",d),s([]))}catch(d){console.error("Failed to load members:",d),s([])}};n.useEffect(()=>{D()},[]);const M=async d=>{if(u===d)A(null);else if(A(d),!Q[d])try{const l=await er(d);F(z=>({...z,[d]:l}))}catch(l){console.error("Error fetching loans:",l)}},J=Array.isArray(r)?r.filter(d=>d.parent_name.toLowerCase().includes(b.toLowerCase())||d.kid_name.toLowerCase().includes(b.toLowerCase())):[];return e.jsxs("div",{className:"w-full max-w-md mx-auto",children:[e.jsx("button",{className:"w-10 h-10 flex items-center justify-center rounded-full border border-teal-500 bg-white/50 text-teal-500 shadow-md absolute top-2 left-2",onClick:S,children:E==="en"?"HE":"EN"}),e.jsx("button",{onClick:()=>N(!C),className:"w-full bg-blue-500 text-white font-semibold py-2 rounded-md hover:bg-blue-600 transition mb-4",children:C?`- ${x.close_add_member_button}`:`+ ${x.add_member_button}`}),C&&e.jsxs("form",{onSubmit:P,className:"mb-4",children:[e.jsx("input",{type:"text",placeholder:x.parent_name_placeholder,value:o,onChange:d=>c(d.target.value),className:"input mb-2 w-full border border-gray-300 rounded-md py-2 px-4"}),w.parentName&&e.jsx("p",{className:"text-red-500 text-sm",children:w.parentName}),e.jsx("input",{type:"text",placeholder:x.kid_name_placeholder,value:p,onChange:d=>m(d.target.value),className:"input mb-2 w-full border border-gray-300 rounded-md py-2 px-4"}),w.kidName&&e.jsx("p",{className:"text-red-500 text-sm",children:w.kidName}),e.jsx("input",{type:"email",placeholder:x.email_placeholder,value:y,onChange:d=>j(d.target.value),className:"input mb-2 w-full border border-gray-300 rounded-md py-2 px-4"}),w.email&&e.jsx("p",{className:"text-red-500 text-sm",children:w.email}),e.jsx("button",{type:"submit",className:"w-full bg-green-500 text-white font-semibold py-2 rounded-md hover:bg-green-600 transition",children:x.add_member_button}),B&&e.jsx("p",{className:"text-green-500 text-sm mt-2",children:B})]}),e.jsx("input",{type:"text",placeholder:x.search_placeholder,value:b,onChange:d=>h(d.target.value),className:`input w-full border border-gray-300 rounded-md py-2 px-4 mb-4 ${E==="he"?"text-right":"text-left"} ${E==="he"?"rtl":"ltr"}`}),e.jsx("div",{dir:U,children:e.jsx("div",{className:"overflow-y-auto max-h-96 border-t pt-4",children:J.map(d=>e.jsxs("div",{className:"bg-gray-50 shadow-sm rounded-lg p-4 mb-2 relative",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("h2",{className:"font-bold text-gray-800",children:[x.parent_name_label,": ",d.parent_name]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[x.kid_name_label,": ",d.kid_name]}),e.jsxs("p",{className:"text-sm mb-2 text-gray-500",children:[x.email_label,": ",d.email||x.no_email_provided]}),e.jsxs("p",{className:"text-sm mb-8 text-gray-700 font-semibold",children:[x.borrowed_books_label,": ",d.borrowed_books_count]}),u===d.id&&Q[d.id]&&e.jsxs("div",{className:"mt-2 p-2 bg-gray-100 rounded",children:[e.jsx("h3",{className:"font-semibold text-gray-700",children:x.borrowed_books_label}),e.jsx("ul",{children:Q[d.id].map((l,z)=>e.jsxs("li",{className:"text-sm text-gray-600",children:[l.book_title," (",x.borrow_date,": ",l.borrowed_at,")"]},z))})]})]}),e.jsx("div",{className:"absolute bottom-4 inset-x-4 flex justify-between items-center",children:e.jsxs("div",{className:"flex gap-2",children:[d.borrowed_books_count>0?e.jsxs("button",{onClick:()=>alert(x.cannot_delete_with_borrowed_books),className:"text-gray-400 cursor-not-allowed relative","aria-label":x.cannot_delete_with_borrowed_books,children:[e.jsx(we,{size:20}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:"w-[28px] h-[2px] bg-gray-400 rotate-45 absolute"})})]}):e.jsx("button",{onClick:()=>K(d.id),className:"text-gray-600 hover:text-red-600 transition-colors duration-200","aria-label":x.delete_member,children:e.jsx(we,{size:20})}),e.jsx("button",{onClick:()=>G(d),className:"text-gray-600 hover:text-emerald-600 transition-colors duration-200","aria-label":x.edit_member,children:e.jsx(Ce,{size:20})}),d.borrowed_books_count>0&&e.jsx("button",{onClick:()=>M(d.id),className:"text-gray-600 hover:text-blue-600 transition-colors duration-200","aria-label":x.More_Details,children:e.jsx(Ae,{size:20})})]})})]},d.id))})})]})}async function ge(){return await(await Y.get(`${O}/api/available_books`)).data}async function xe(){return await(await Y.get(`${O}/api/borrowed_books`)).data}async function dr(r){return await(await Y.get(`${O}/api/book/${r}`)).data}async function cr(){const r=await L.get("/api/members");return console.log("API Response:",r.data),r.data.members||r.data}const ur=async(r,s,o)=>{try{return(await L.post("/api/book/borrow",{qr_code:r,member_id:s,book_state:o})).data}catch(c){throw console.error("Error borrowing book:",c.response||c),c}},mr=async r=>{try{return(await L.post("/api/book/return",{qr_code:r})).data}catch(s){throw console.error("Error returning book:",s),s}};async function re(r,s){return(await Y.get(`${O}/api/loans/history`,{params:{qr_code:r||"",show_all:s?"true":"false"}})).data}const hr=async(r,s,o,c="en")=>{var p,m;try{return(await L.post("/api/send-reminder",{loan_id:r,subject:s,loan_details:o,language:c})).data}catch(y){return console.error(`Error sending reminder for loan_id ${r}:`,y),{success:!1,error:((m=(p=y.response)==null?void 0:p.data)==null?void 0:m.error)||y.message||"Unknown error"}}},Se=async r=>{try{const s=await Y.get(`${O}/api/reminders/last/${r}`),{sent_at:o}=s.data;return{sent_at:o}}catch(s){return console.error(`Error fetching last reminder for loan_id ${r}:`,s),null}},br=({onScanSuccess:r,onScanError:s,onScanCancel:o})=>{const[c,p]=n.useState(!1),m=async(j,C,N={})=>{try{const b=await j.scanFile(C,!0,N);return console.log("Scan attempt succeeded:",b),b}catch(b){throw console.log("Scan attempt failed:",b),b}},y=async j=>{const C=j.target.files[0];if(!C)return;p(!0);const N=new Fe("qr-reader");try{const b=[{},{bindSearchRegion:!0,maxLength:512,minLength:1},{returnDetailedScanResult:!0,maxLength:512,minLength:1},{experimentalFeatures:{useBarCodeDetectorIfSupported:!1},maxLength:512,minLength:1}];for(let h=0;h<b.length;h++)try{console.log(`Attempting scan with config ${h+1}:`,b[h]);const w=await m(N,C,b[h]);if(w){N.clear(),r(w);return}}catch(w){console.log(`Config ${h+1} failed:`,w)}throw new Error("Unable to scan QR code with any configuration")}catch(b){console.error("Final error:",b),s(b)}finally{try{await N.clear()}catch(b){console.error("Error clearing scanner:",b)}p(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg max-w-md w-full",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Scan QR Code"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{id:"qr-reader",style:{display:"none"}}),e.jsx("div",{className:"flex flex-col items-center",children:e.jsxs("label",{className:"w-full flex flex-col items-center px-4 py-6 bg-coral text-blue rounded-lg shadow-lg tracking-wide uppercase border border-blue cursor-pointer hover:bg-blue hover:text-white",children:[e.jsx("span",{className:"mt-2 text-base leading-normal",children:"Select an image"}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:y,disabled:c})]})}),c&&e.jsx("div",{className:"text-center text-gray-600",children:"Processing image..."}),e.jsx("button",{onClick:o,className:"w-full mt-4 px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300",children:"Cancel"})]})]})})},$={coral:"#F38181",teal:"#4ECAC7",yellow:"#FEC43C"};function pr(){const[r,s]=n.useState(""),[o,c]=n.useState([]),[p,m]=n.useState([]),[y,j]=n.useState(""),[C,N]=n.useState(""),[b,h]=n.useState(null),[w,v]=n.useState(""),[B,k]=n.useState([]),[E,S]=n.useState(""),[U,x]=n.useState(null);n.useState([]);const[I,R]=n.useState([]),[u,A]=n.useState(!1),[Q,F]=n.useState(!1),[W,P]=n.useState(!1),[K,G]=n.useState(!1),[D,M]=n.useState([]),[J,d]=n.useState(!1),{language:l,toggleLanguage:z,direction:ue}=Z(),_=ee(l),[H,te]=n.useState(!0);n.useEffect(()=>{(async()=>{try{const[i,g,f]=await Promise.all([cr(),ge(),xe()]);c(i),m(g),k(f)}catch(i){console.error("Error loading initial data:",i)}})()},[]),n.useEffect(()=>{(async()=>{try{let i=null;r==="return"?i=E||null:r==="borrow"&&(i=C||null);const g=await re(i,u),f=await Promise.all(g.map(async q=>{try{const X=await Se(q.id);return{...q,last_reminder_date:X?X.sent_at:null}}catch(X){return console.error(`Failed to fetch reminder for loan_id ${q.id}:`,X),{...q,last_reminder_date:null}}}));R(ne(f))}catch(i){console.error("Error fetching loan history:",i),R([])}})()},[u,r,E,C]),n.useEffect(()=>{h(null),N(""),x(null),S(""),v(""),j(null)},[r]);const oe=o.map(t=>({value:t.id,label:H?t.parent_name:t.kid_name,parentName:t.parent_name,childName:t.kid_name})),se=p.map(t=>({value:t.qr_code,label:t.title})),me=t=>{if(!t.returned_at){const i=B.find(g=>g.id===t.book_id);i?(x(i),S(i.qr_code),h(i),v(i.delivery_status||""),window.scrollTo({top:0,behavior:"smooth"})):alert("Book not found in borrowed books.")}},he=(t,i)=>{t.stopPropagation(),t.target.checked?M([...D,i]):M(D.filter(g=>g.id!==i.id))},be=async()=>{d(!0);try{const t=await Promise.all(D.map(async f=>{try{const q=await hr(f.id,"Book Return Reminder",{borrower_name:f.borrower_name,book_title:f.book_title,borrowed_at:f.borrowed_at},l);if(q.success){console.log(`Reminder sent successfully for loan_id: ${f.id}`);const X=new Date().toISOString().slice(0,19).replace("T"," ");R(_e=>_e.map(V=>V.id===f.id?{...V,last_reminder_date:X}:V));const le=await Se(f.id);le!=null&&le.sent_at&&R(_e=>_e.map(V=>V.id===f.id?{...V,last_reminder_date:le.sent_at}:V))}else console.error(`Failed to send reminder for loan_id: ${f.id} - ${q.error}`);return{success:q.success,loanId:f.id,error:q.error}}catch(q){return console.error(`Error sending reminder for loan_id ${f.id}:`,q),{success:!1,loanId:f.id,error:q.message}}})),i=t.filter(f=>f.success).length,g=t.filter(f=>!f.success);if(i>0&&alert(`Sent ${i} reminders successfully!`),g.length>0){const f=g.map(q=>`Loan ID: ${q.loanId} - ${q.error}`).join(`
`);alert(`Failed to send ${g.length} reminders.

${f}`)}M([]),G(!1)}catch(t){console.error("Failed to send reminders:",t),alert("Failed to send reminders. Please check your email service configuration.")}finally{d(!1)}},pe=async t=>{const i=t.target.checked;A(i);try{let g=null;r==="return"?g=E||null:r==="borrow"&&(g=C||null);const f=await re(g,i);R(ne(f))}catch(g){console.error("Error fetching loan history:",g),R([])}},ae=async()=>{P(!0),F(!0)},a=async t=>{try{console.log("Handling scan result..."),F(!1),P(!0);const i=await dr(t);if(i)if(r==="borrow"?(N(t),h(i)):r==="return"&&(S(t),x(i),h(i),x(i)),v(i.delivery_status),i.loan_status==="borrowed"){const g=await re(t);if(g&&g.length>0){const f=g[0];alert(`The book "${i.title}" was borrowed by ${f.borrower_name} on ${f.borrowed_at}.`)}else alert(`The book "${i.title}" is marked as borrowed, but no loan history is available.`)}else alert(`The book "${i.title}" is available.`);else alert("Book not found for the given QR code.")}catch(i){console.error("Error processing scan result:",i),alert("An error occurred while processing the QR code.")}finally{P(!1)}},T=t=>{console.error("QR Scan Error:",t),F(!1),P(!1),alert("Failed to scan QR code. Please try again.")},Le=()=>{F(!1),P(!1)},Re=async()=>{if(y&&b&&w)try{if((await ur(b.qr_code,y.id,w)).message){alert("Book borrowed successfully!"),h(null),j(null),v("");const i=await ge(),g=await xe(),f=await re(null,u);m(i),k(g),R(ne(f))}else alert("Error borrowing book.")}catch(t){console.error("Failed to borrow book:",t)}else alert("Please select a borrower, book, and book state.")},$e=async()=>{if(!E){alert("Please select a book to return.");return}try{if((await mr(E)).success){alert("Book returned successfully!"),x(null),S(""),h(null),v("");const i=await ge(),g=await xe(),f=await re(null,u);m(i),k(g),R(ne(f))}else alert("Failed to return the book. Please try again.")}catch(t){console.error("Error returning book:",t),alert("An error occurred while returning the book. Please try again.")}},ne=t=>t.sort((i,g)=>!i.return_date&&g.return_date?-1:i.return_date&&!g.return_date?1:new Date(g.loan_start_date)-new Date(i.loan_start_date));return e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-6",children:[Q&&e.jsx("div",{className:"scanner-modal",children:e.jsx(br,{onScanSuccess:a,onScanError:T,onScanCancel:Le})}),e.jsxs("div",{className:"flex gap-4 mb-4",children:[e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx("button",{className:"w-10 h-10 flex items-center justify-center rounded-full border border-teal-500 bg-white/50 text-teal-500 shadow-md",onClick:z,children:l==="en"?"HE":"EN"})}),e.jsx("button",{className:`flex-1 py-2 px-4 rounded ${r==="borrow"?"text-white":"text-gray-800"}`,style:{backgroundColor:r==="borrow"?$.coral:"transparent",borderColor:$.coral,borderWidth:"1px"},onClick:()=>s("borrow"),children:_.borrow}),e.jsx("button",{className:`flex-1 py-2 px-4 rounded ${r==="return"?"text-white":"text-gray-800"}`,style:{backgroundColor:r==="return"?$.coral:"transparent",borderColor:$.coral,borderWidth:"1px"},onClick:()=>s("return"),children:_.return})]}),r==="borrow"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ke,{options:oe,placeholder:H?_.parent_name_placeholder:_.kid_name_placeholder,value:y?{value:y.id,label:H?y.parent_name:y.kid_name}:null,onChange:t=>{if(t){const i=o.find(g=>g.id===t.value||g.parent_name===t.label||g.kid_name===t.label);j(i||null)}else j(null)},isClearable:!0,styles:{control:t=>({...t,textAlign:l==="he"?"right":"left",direction:l==="he"?"rtl":"ltr",borderColor:$.coral,borderRadius:"4px",boxShadow:"none","&:hover":{borderColor:$.teal}})},className:"w-full flex-grow",classNamePrefix:"borrower-select"}),e.jsx("button",{onClick:()=>te(!H),className:`relative inline-flex h-6 w-16 items-center rounded-full transition-colors duration-200 ease-in-out ${H?"bg-teal-600":"bg-gray-200"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-gray-300 transition duration-200 ease-in-out ${H?"translate-x-6":"translate-x-1"}`})}),e.jsx("span",{className:"text-sm text-gray-600",children:H?_.parent_name_borrower:_.kid_name_borrower})]}),e.jsx(ke,{options:se,placeholder:_.Select_Book,value:b?{value:b.qr_code,label:b.title}:null,onChange:t=>{const i=p.find(g=>g.qr_code===(t==null?void 0:t.value));h(i||null),N((t==null?void 0:t.value)||""),v((i==null?void 0:i.delivery_status)||"")},isClearable:!0,styles:{control:t=>({...t,textAlign:l==="he"?"right":"left",direction:l==="he"?"rtl":"ltr",borderColor:$.coral,borderRadius:"4px",boxShadow:"none","&:hover":{borderColor:$.teal}})},className:"w-full",classNamePrefix:"book-select"}),b&&e.jsxs("div",{className:`bg-gray-100 p-4 rounded mt-4 ${l==="he"?"rtl":""}`,children:[e.jsx("h3",{className:"font-bold text-lg",children:b.title}),e.jsxs("p",{className:"text-sm",children:[_.author,": ",b.author]}),e.jsxs("p",{className:"text-sm",children:[_.description,": ",b.description]}),e.jsxs("p",{className:"text-sm",children:[_.year_of_publication,": ",b.year_of_publication]}),e.jsxs("p",{className:"text-sm",children:[_.cover_type,": ",b.cover_type]}),e.jsxs("p",{className:"text-sm",children:[_.pages,": ",b.pages]}),e.jsxs("p",{className:"text-sm",children:[_.recommended_age,": ",b.recommended_age]}),e.jsxs("p",{className:"text-sm",children:[_.Select_Book_State,": ",b.book_condition]})]}),b&&e.jsxs("select",{className:"w-full p-2 border rounded mt-2",style:{borderColor:$.coral},onChange:t=>v(t.target.value),value:w,children:[e.jsx("option",{value:"",children:_.Select_Book_State}),e.jsx("option",{value:"כמו חדש",children:_.new}),e.jsx("option",{value:"מצויין - בלאי בלתי מורגש",children:_.good}),e.jsx("option",{value:"טוב - בלאי קל",children:_.worn})]}),e.jsxs("button",{className:"w-full flex items-center justify-center py-2 px-4 rounded text-white",style:{backgroundColor:$.coral},onClick:ae,children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),_.ScanQR]}),e.jsx("button",{className:"w-full py-2 px-4 rounded text-white mt-2",style:{backgroundColor:$.coral},onClick:Re,children:_.borrow}),e.jsx("div",{className:`loan-history-container ${l==="he"?"rtl":""}`,children:p.map(t=>e.jsxs("div",{className:`loan-history-card ${(b==null?void 0:b.qr_code)===t.qr_code?"active-loan":""} ${l==="he"?"rtl":""}`,onClick:()=>{h(t),N(t.qr_code),v(t.delivery_status||"")},style:{cursor:"pointer"},children:[e.jsx("div",{className:"loan-history-card-header",children:e.jsx("h3",{className:"loan-history-card-title",children:t.title})}),e.jsxs("div",{className:"loan-history-card-body",children:[e.jsxs("p",{className:"loan-history-card-detail",children:[_.author,": ",t.author]}),e.jsxs("p",{className:"loan-history-card-detail",children:[_.year_of_publication,": ",t.year_of_publication]}),e.jsxs("p",{className:"loan-history-card-detail",children:[_.pages,": ",t.pages]}),e.jsxs("p",{className:"loan-history-card-detail",children:[_.recommended_age,": ",t.recommended_age]})]})]},t.qr_code))})]}),r==="return"&&e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"mt-4",children:e.jsxs("select",{value:E||"",onChange:t=>{const i=t.target.value;S(i);const g=B.find(f=>f.qr_code===i);g&&(h(g),v(g.delivery_status||""))},className:"w-full p-2 border rounded",style:{borderColor:$.coral,textAlign:l==="he"?"right":"left",direction:l==="he"?"rtl":"ltr"},children:[e.jsx("option",{value:"",children:_.Select_Book}),B.map(t=>e.jsx("option",{value:t.qr_code,children:t.title},t.qr_code))]})}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("button",{className:"w-full flex items-center justify-center py-2 px-4 rounded text-white",style:{backgroundColor:$.coral},onClick:ae,children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),_.ScanQR]}),e.jsx("button",{className:"w-full py-2 px-4 rounded text-white mt-2",style:{backgroundColor:$.coral},onClick:$e,disabled:!U,children:_.return}),e.jsxs("button",{className:"w-full flex items-center justify-center py-2 px-4 rounded text-white mt-2",style:{backgroundColor:$.teal},onClick:()=>G(!K),children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),_.SendReminders]})]}),e.jsx("div",{className:"flex items-center my-4",children:e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:t=>pe({target:{checked:!u}}),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors duration-200 ease-in-out ${u?"bg-teal-600":"bg-gray-200"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition duration-200 ease-in-out ${u?"translate-x-6":"translate-x-1"}`})}),e.jsx("span",{className:"text-sm text-gray-600",children:_.ShowAllLoans})]})}),K&&I.filter(t=>!t.returned_at).length>0&&e.jsxs("div",{className:"reminder-section bg-gray-100 p-4 rounded-lg mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:_.SendReminders}),e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:D.length===I.filter(t=>!t.returned_at).length,onChange:t=>{if(t.target.checked){const i=I.filter(g=>!g.returned_at);M(i)}else M([])},className:"w-4 h-4 text-teal-500 border-gray-300 rounded focus:ring-teal-500 cursor-pointer"}),e.jsx("span",{className:"ml-2",children:_.select_all})]})]}),e.jsx("button",{className:"w-full py-2 px-4 rounded text-white",style:{backgroundColor:$.coral},onClick:be,disabled:D.length===0||J,children:J?_.sending_reminders:_.send_x_reminders.replace("{count}",D.length)})]}),I.length>0&&e.jsx("div",{className:`loan-history-container ${l==="he"?"rtl":""}`,children:I.map(t=>e.jsxs("div",{className:`loan-history-card ${t.returned_at?"":"active-loan"} ${l==="he"?"rtl":""}`,onClick:()=>r==="return"&&me(t),children:[e.jsxs("div",{className:"loan-history-card-header",children:[K&&!t.returned_at&&e.jsx("div",{onClick:i=>i.stopPropagation(),children:e.jsxs("label",{className:"custom-checkbox",children:[e.jsx("input",{type:"checkbox",checked:D.some(i=>i.id===t.id),onChange:i=>he(i,t),className:"hidden-checkbox"}),e.jsx("span",{className:"checkbox-mark"})]})}),e.jsx("div",{className:"loan-history-card-title",children:t.book_title})]}),e.jsxs("div",{className:"loan-history-card-body",children:[e.jsxs("div",{className:"loan-history-card-detail",children:[_.borrowed_by," ",t.borrower_name]}),e.jsxs("div",{className:"loan-history-card-detail",children:[_.kid_name_borrower,": ",t.borrower_child||"N/A"]}),e.jsxs("div",{className:"loan-history-card-detail",children:[_.borrow_date,": ",t.borrowed_at]}),t.returned_at&&e.jsxs("div",{className:"loan-history-card-detail",children:[_.return_date,": ",t.returned_at]}),e.jsxs("div",{className:"loan-history-card-detail",children:[_.delivery_status,": ",t.book_state||"N/A"]}),t.last_reminder_date?e.jsxs("div",{className:"loan-history-card-detail",children:[_.last_reminder,": ",t.last_reminder_date]}):e.jsx("div",{className:"loan-history-card-detail no-reminder",children:_.no_reminder_sent})]})]},t.id))})]})]})}const ce=navigator.language||"en-US",_r=async(r="desc",s="title",o=!0)=>{try{const c=new URLSearchParams({order_by:r,sort_column:s,include_history:o.toString()});return(await L.get(`/api/generate_books_report?${c.toString()}`,{headers:{"Accept-Language":ce},responseType:"blob"})).data}catch(c){throw console.error("Error generating books report:",c),c}},gr=async(r="desc",s="title",o=!1)=>{try{const c=new URLSearchParams({order_by:r,sort_column:s,include_borrowed:o.toString()});return(await L.get(`/api/generate_inventory_report?${c.toString()}`,{headers:{"Accept-Language":ce},responseType:"blob"})).data}catch(c){throw console.error("Error generating inventory report:",c),c}},xr=async(r,s)=>{try{const o={start_qr:r,end_qr:s};return(await L.post("/api/reports/qr_codes",o,{headers:{"Accept-Language":ce},responseType:"blob"})).data}catch(o){throw console.error("Error generating QR codes report:",o),o}},fr=async()=>{try{return(await L.get("/api/qr_codes",{headers:{"Accept-Language":ce}})).data}catch(r){throw console.error("Error fetching QR codes:",r),r}},yr=()=>{const{language:r,toggleLanguage:s}=Z(),o=ee(r),[c,p]=n.useState(!1),[m,y]=n.useState(!0),[j,C]=n.useState("desc"),[N,b]=n.useState(""),[h,w]=n.useState(""),[v,B]=n.useState(""),[k,E]=n.useState(""),[S,U]=n.useState(null),x={inventory:[{value:"title",label:o.book_title},{value:"author",label:o.author},{value:"id",label:o.id},{value:"loan_status",label:o.loan_status}],loans:[{value:"title",label:o.book_title},{value:"author",label:o.author},{value:"id",label:o.id}]};n.useEffect(()=>{h==="qr_codes"&&fr().then(u=>{const A=u.length;U(A),B("1"),E(String(A))}).catch(u=>{console.error("Error fetching QR codes:",u),U(0)})},[h]);const I=()=>{if(h==="qr_codes"){if(!v||!k)return!0;const u=parseInt(v,10),A=parseInt(k,10);return u>A||S!==null&&A>S}else return!N},R=async()=>{try{let u;h==="inventory"?u=await gr(j,N,m):h==="loans"?u=await _r(j,N,c):h==="qr_codes"&&(u=await xr(parseInt(v,10),parseInt(k,10)));const A=window.URL.createObjectURL(new Blob([u])),Q=document.createElement("a");Q.href=A,Q.setAttribute("download",`${h}_report.${h==="qr_codes"?"pdf":"xlsx"}`),document.body.appendChild(Q),Q.click()}catch(u){console.error("Error generating report:",u),alert(o.error_generating_report)}};return e.jsxs("div",{className:`report-container ${r==="he"?"rtl":""}`,dir:r==="he"?"rtl":"ltr",children:[e.jsx("button",{onClick:s,className:"w-10 h-10 flex items-center justify-center rounded-full border border-teal-500 bg-white/50 text-teal-500 shadow-md absolute top-2 left-2",children:r==="en"?"HE":"EN"}),e.jsxs("div",{className:"p-4 bg-white rounded-lg shadow-md",children:[e.jsxs("div",{className:"flex items-center justify-center mb-4",children:[e.jsx(De,{className:"w-6 h-6 mr-2 text-teal-500"}),e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:o.reports})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border-gray-200 border-1",dir:r==="he"?"rtl":"ltr",children:[e.jsxs("h3",{className:"text-md font-semibold text-teal-600 mb-3 flex items-center",children:[e.jsx(Qe,{className:`w-4 h-4 ${r==="he"?"ml-2":"mr-2"}`}),o.report_type_title||o.select_report_type]}),e.jsx("div",{className:"space-y-2",children:["inventory","loans","qr_codes"].map(u=>e.jsx("button",{onClick:()=>w(u),className:`w-full p-2 rounded-lg ${r==="he"?"text-right":"text-left"} text-sm ${h===u?"bg-teal-500 text-white shadow-md":"bg-white text-gray-700 hover:bg-gray-100 border border-gray-200"}`,children:u==="inventory"?o.inventory_report:u==="loans"?o.loans_report:o.qr_codes_report||"QR Codes PDF"},u))})]}),e.jsx("div",{className:`bg-gray-100 p-4 rounded-lg border border-gray-300 ${h?"":"opacity-50 pointer-events-none"}`,children:h&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-md font-semibold text-teal-600 mb-3 flex items-center",children:[e.jsx(Me,{className:`w-4 h-4 ${r==="he"?"ml-2":"mr-2"}`}),o.report_options]}),e.jsx("p",{className:`text-sm text-gray-600 ${r==="he"?"text-right":"text-left"}`,children:h==="inventory"?o.inventory_report_description||"This report generates an Excel file with current inventory details. You can sort the data by various fields and choose to include borrowed items.":h==="loans"?o.loans_report_description||"This report generates an Excel file of active loans. You can choose to include historical loans and sort by various fields.":o.qr_codes_description||"This report generates a printable PDF of QR codes arranged in a grid with cutting guides."}),h==="qr_codes"?e.jsxs("div",{className:"space-y-3",children:[S!==null&&e.jsx("p",{className:`text-sm text-purple-600 ${r==="he"?"text-right":"text-left"}`,children:o.qr_codes_available?o.qr_codes_available.replace("{count}",S):`There are ${S} QR codes available.`}),e.jsxs("div",{className:"flex flex-row items-end gap-4",children:[e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("label",{className:"text-xs",children:o.start_qr||"From QR ID"}),e.jsx("input",{type:"number",min:"1",value:v,onChange:u=>B(u.target.value),onBlur:()=>{const u=parseInt(v,10);(isNaN(u)||u<1)&&B("1")},className:"border rounded-md p-1 w-full"})]}),e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("label",{className:"text-xs",children:o.end_qr||"To QR ID"}),e.jsx("input",{type:"number",min:"1",max:S||void 0,value:k,onChange:u=>E(u.target.value),onBlur:()=>{const u=parseInt(k,10);isNaN(u)||u<1?E("1"):S!==null&&u>S&&E(String(S))},className:"border rounded-md p-1 w-full"})]})]}),parseInt(k,10)>S&&e.jsx("p",{className:"text-red-500 text-sm",children:o.end_qr_exceed_error?o.end_qr_exceed_error.replace("{qrCount}",S):`End QR ID cannot exceed ${S}.`}),v&&k&&parseInt(v,10)>parseInt(k,10)&&e.jsx("p",{className:"text-red-500 text-sm",children:o.from_qr_greater_error||"From QR ID cannot be greater than To QR ID."})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[h==="loans"&&e.jsx("div",{className:"flex items-center col-span-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>p(!c),className:`relative inline-flex h-6 w-10 items-center rounded-full transition-colors duration-200 ease-in-out ${c?"bg-teal-600":"bg-gray-200"}`,children:e.jsx("span",{className:`absolute ${r==="he"?"right-1":"left-1"} top-1 h-4 w-4 transform rounded-full bg-white transition-transform duration-200 ease-in-out ${c?r==="he"?"-translate-x-5":"translate-x-5":"translate-x-0"}`})}),e.jsx("span",{className:"text-sm text-gray-600",children:o.include_history})]})}),h==="inventory"&&e.jsx("div",{className:"flex items-center col-span-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>y(!m),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors duration-200 ease-in-out ${m?"bg-teal-600":"bg-gray-200"}`,children:e.jsx("span",{className:`absolute ${r==="he"?"right-1":"left-1"} top-1 h-4 w-4 transform rounded-full bg-white transition-transform duration-200 ease-in-out ${m?r==="he"?"-translate-x-5":"translate-x-4":"translate-x-0"}`})}),e.jsx("span",{className:"text-sm text-gray-600",children:o.include_borrowed})]})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{children:o.sort_by}),e.jsxs("select",{value:N,onChange:u=>b(u.target.value),className:"border rounded-md",children:[e.jsx("option",{value:"",children:o.select_field}),x[h].map(u=>e.jsx("option",{value:u.value,children:u.label},u.value))]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{children:o.order}),e.jsxs("select",{value:j,onChange:u=>C(u.target.value),className:"border rounded-md",children:[e.jsx("option",{value:"asc",children:o.ascending}),e.jsx("option",{value:"desc",children:o.descending})]})]})]}),e.jsxs("button",{onClick:R,disabled:I(),className:`w-full p-2 bg-teal-500 text-white rounded-md flex items-center justify-center ${r==="he"?"flex-row-reverse":""}`,children:[o.generate_report_button," ",e.jsx(Pe,{className:`w-4 h-4 ${r==="he"?"ml-2":"mr-2"}`})]})]})})]})]})]})},wr="/icm_lib/assets/banner_nobg-ldt_Oxdo.png";function vr(){const[r,s]=n.useState(!1),o=()=>{s(!0)},c=()=>{s(!1)};return e.jsx(Ke,{children:r?e.jsx(jr,{onLogout:c}):e.jsx(Xe,{onLogin:o})})}function jr({onLogout:r}){const{language:s}=Z(),o=ee(s),c=s==="he",p=c?[{value:"reports",icon:e.jsx(ve,{className:"w-4 h-4 mr-2"}),label:o.reports},{value:"members",icon:e.jsx(je,{className:"w-4 h-4 mr-2"}),label:o.members},{value:"loans",icon:e.jsx(de,{className:"w-4 h-4 mr-2"}),label:o.loans},{value:"inventory",icon:e.jsx(Ne,{className:"w-4 h-4 mr-2"}),label:o.books}]:[{value:"inventory",icon:e.jsx(Ne,{className:"w-4 h-4 mr-2"}),label:o.books},{value:"loans",icon:e.jsx(de,{className:"w-4 h-4 mr-2"}),label:o.loans},{value:"members",icon:e.jsx(je,{className:"w-4 h-4 mr-2"}),label:o.members},{value:"reports",icon:e.jsx(ve,{className:"w-4 h-4 mr-2"}),label:o.reports}];return e.jsxs("div",{className:`app-container min-h-screen bg-blend-screen max-w-md mx-auto ${c?"rtl":"ltr"}`,children:[e.jsxs("header",{className:"bg-white drop-shadow-2xl rounded-full",children:[e.jsxs("div",{className:"banner-container",children:[e.jsx("img",{src:wr,alt:"ICM Library Logo",className:"banner-logo"}),e.jsx("div",{className:"banner-text",children:e.jsx("p",{className:"text-sm text-gray-600",children:o.app_title})})]}),e.jsx("button",{className:"logout-button",onClick:r,title:"Logout",children:e.jsx(Te,{className:"logout-icon"})})]}),e.jsx("div",{className:"max-w-md mx-auto",children:e.jsxs(He,{defaultValue:"inventory",className:"tabs-content",children:[e.jsx(Oe,{className:"tabs-list w-full shadow-md rounded-lg grid grid-cols-4",children:p.map(m=>e.jsxs(Ue,{value:m.value,className:`tab-item 
                                flex items-center justify-center 
                                text-gray-800 py-2 rounded-t-lg hover:bg-gray-100 
                                ${m.value==="inventory"&&"data-[state=active]:bg-teal-500 data-[state=active]:!text-white"}
                                ${m.value==="loans"&&"data-[state=active]:bg-red-500 data-[state=active]:!text-white"}
                                ${m.value==="members"&&"data-[state=active]:bg-[#FDB813] data-[state=active]:!text-white"}
                                ${m.value==="reports"&&"data-[state=active]:bg-purple-500 data-[state=active]:!text-white"}`,children:[m.icon,m.label]},m.value))}),e.jsx("div",{style:{height:"15px"}}),e.jsx(ie,{value:"inventory",children:e.jsx(lr,{})}),e.jsx(ie,{value:"loans",children:e.jsx(pr,{})}),e.jsx(ie,{value:"members",children:e.jsx(ir,{})}),e.jsx(ie,{value:"reports",children:e.jsx(yr,{})})]})})]})}qe(document.getElementById("root")).render(e.jsx(n.StrictMode,{children:e.jsx(vr,{})}));
